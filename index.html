  <script>
  (() => {
    // ==========================================
    // 1. ‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (DATA CONFIGURATION)
    // ==========================================
    
    const ADDRESSES = {
      home: { 
        houseNumber: "82/7", soi: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á16", village: "‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£2", 
        road: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", road_en: "Lat Krabang Rd.",
        subdistrict: "‡∏£‡∏≤‡∏ä‡∏≤‡πÄ‡∏ó‡∏ß‡∏∞", subdistrict_en: "Racha Thewa",
        district: "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ", district_en: "Bang Phli",
        province: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", province_en: "Samut Prakan",
        postalCode: "10540" 
      },
      alt1: { 
        houseNumber: "22/4", soi: "‡πÉ‡∏à‡πÄ‡∏≠‡∏∑‡πâ‡∏≠ 2", village: "", road: "", 
        subdistrict: "‡∏ö‡∏≤‡∏á‡∏Ç‡∏∞‡πÅ‡∏¢‡∏á", subdistrict_en: "Bang Khayaeng",
        district: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á", district_en: "Mueang",
        province: "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", province_en: "Pathum Thani",
        postalCode: "12000" 
      },
      nack: { 
        houseNumber: "42/3", soi: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á14/1", village: "‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏≠‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏°‡∏ô", road: "", 
        subdistrict: "‡∏£‡∏≤‡∏ä‡∏≤‡πÄ‡∏ó‡∏ß‡∏∞", subdistrict_en: "Racha Thewa",
        district: "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ", district_en: "Bang Phli",
        province: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", province_en: "Samut Prakan",
        postalCode: "10540" 
      },
      mint: { 
        houseNumber: "1400", soi: "‡∏≠‡πà‡∏≠‡∏ô‡∏ô‡∏∏‡∏ä 42", 
        village: "‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏ß‡∏á‡∏®‡πå‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏û‡∏£ ‡πÅ‡∏°‡∏ô‡∏ä‡∏±‡πà‡∏ô", // ‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡πÄ‡∏™‡∏°‡∏≠
        road: "‡∏≠‡πà‡∏≠‡∏ô‡∏ô‡∏∏‡∏ä", road_en: "On Nut Rd.",
        subdistrict: "‡∏™‡∏ß‡∏ô‡∏´‡∏•‡∏ß‡∏á", subdistrict_en: "Suan Luang",
        district: "‡∏™‡∏ß‡∏ô‡∏´‡∏•‡∏ß‡∏á", district_en: "Suan Luang",
        province: "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", province_en: "Bangkok",
        postalCode: "10250" 
      },
      first: { 
        houseNumber: "1008", soi: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á 34/6", village: "‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô ‡∏ö.‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡πÄ‡∏î‡πâ‡∏ô‡∏ó‡πå", 
        road: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", road_en: "Lat Krabang Rd.",
        subdistrict: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", subdistrict_en: "Lat Krabang",
        district: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", district_en: "Lat Krabang",
        province: "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", province_en: "Bangkok",
        postalCode: "10520" 
      }
    };

    const PHONES = { 
      home: "0951698770", 
      alt1: "0946401569",
      nack: "0820571500", 
      mint: "0959936570", // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏°‡∏¥‡πâ‡∏ô‡∏ó‡πå
      first: "" 
    };

    let CURRENT_ADDRESS_KEY = 'home';

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Dropdown
    document.getElementById('addressSelect').innerHTML = 
      '<option value="home">‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£</option>' + 
      '<option value="alt1">‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏ó‡∏∏‡∏°</option>' +
      '<option value="nack">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ô‡πâ‡∏Ñ</option>' +
      '<option value="mint">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏°‡∏¥‡∏ô‡∏ó‡πå</option>' +
      '<option value="first">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏™</option>';
      
    document.getElementById('obfuscationSelect').innerHTML = 
      '<option value="v1">‚ú® ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà V.1 (‡πÄ‡∏ô‡πâ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢/‡∏ß‡∏£‡∏£‡∏Ñ)</option>' +
      '<option value="v2">‚ö° ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà V.2 (‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏ß‡∏£‡∏£‡∏Ñ)</option>' +
      '<option value="low">üü¢ ‡∏ï‡πà‡∏≥ - ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</option>' +
      '<option value="medium" selected>üü° ‡∏Å‡∏•‡∏≤‡∏á - ‡∏™‡∏°‡∏î‡∏∏‡∏•</option>' +
      '<option value="high">üî¥ ‡∏™‡∏π‡∏á - ‡∏û‡∏£‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏Å</option>' +
      '<option value="extreme">‚ö´ ‡∏™‡∏∏‡∏î‡∏Ç‡∏±‡πâ‡∏ô - ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å</option>';

    document.getElementById('addressSelect').addEventListener('change', (e) => { CURRENT_ADDRESS_KEY = e.target.value; generateNew(); });

    let stats = { generateCount: 0, copyCount: 0 };
    let history = [];
    
    // ==========================================
    // 2. ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏ß‡∏ä‡πà‡∏ß‡∏¢ (UTILS)
    // ==========================================

    const Labels = {
      house: ['‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô', 'House No.', 'Address No.', 'Addr. No.', 'Unit', '#', ''],
      phone: ['‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', '‡πÇ‡∏ó‡∏£', '‡πÄ‡∏ö‡∏≠‡∏£‡πå', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£', 'Tel', 'Tel.', 'Mobile', 'Contact', 'Contact No.', ''],
      soi: ['‡∏ã‡∏≠‡∏¢', '‡∏ã.', 'Soi', ''],
      village: ['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô', '‡∏°.', '‡∏´‡∏°‡∏π‡πà', ''],
      road: ['‡∏ñ‡∏ô‡∏ô', '‡∏ñ.', 'Rd.', ''],
      subdistrict: ['‡∏ï‡∏≥‡∏ö‡∏•', '‡∏ï.', '‡πÅ‡∏Ç‡∏ß‡∏á'],
      district: ['‡∏≠‡∏≥‡πÄ‡∏†‡∏≠', '‡∏≠.', '‡πÄ‡∏Ç‡∏ï'],
      province: ['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '‡∏à.', ''],
      postal: ['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±‡∏™', 'Zip', '']
    };

    const FuzzyLabels = {
      house: ['‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡πÖ‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏ã‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤‡∏ô‡πÄx‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤u‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πÖ‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡πÖ‡∏ô‡πÄ‡∏•x‡∏ó‡∏µ‡πà', '‡∏ö‡∏≤u‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', 'l‡∏ö‡πÖ‡∏ô‡πÄ‡∏•‡∏Ç', 'H0use No.', 'H‡πêuse', 'Addr. No.', 'L‡∏ö‡πâ‡∏≤‡∏ô'],
      phone: ['‡πÇ‡∏ós‡∏±‡∏û‡∏ó‡πå', '‡πÇ‡∏ó‡∏£s‡∏±s‡∏ó‡πå', '‡πÇ‡∏óp‡∏®‡∏±‡∏û', '‡πÇ‡∏ó‡∏£s‡∏±‡∏ö', '‡πÄbo‡∏£‡πå', 'l‡πÄ‡∏öo‡∏£‡πå', '‡πÄb‡∏≠‡∏£‡πå', '‡πÇ‡∏ós', 'T‚ÑÆl', 'Mob1le', 'C0ntact', 'Tel.'],
      soi: ['‡∏ão‡∏¢', '‡∏ãx‡∏¢', '‡∏ã0‡∏¢'],
      village: ['‡∏´‡∏°‡∏π‡πà‡∏ö‡∏≤u', '‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤u', '‡∏´‡∏°‡∏πv‡∏ö‡∏≤u'],
      road: ['‡∏ñu‡∏ô', '‡∏ñuv', '‡∏ñv‡∏ô'],
      subdistrict: ['‡∏ï‡∏≥‡∏öu', '‡∏ï‡πç‡∏≤‡∏ö‡∏•', '‡∏ïx‡∏ö‡∏•'],
      district: ['‡∏≠‡∏≥p‡∏≠', '‡∏≠‡∏≥‡πÄ‡πÖ‡∏≠', '‡∏≠‡πç‡∏≤‡πÄ‡∏†o'],
      province: ['‡∏à‡∏±‡∏á‡∏´‡∏ß‡πâ‡∏î', '‡∏à‡∏±n‡∏´‡∏ß‡∏±‡∏î', '‡∏à‡∏±J‡∏´‡∏ß‡∏±‡∏î'],
      postal: ['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õs‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±n‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±‡∏™‡πÑp‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå']
    };

    const Separators = [', ', ' ', '  ', '   ', '. ', ' - '];

    const ObfuscationUtils = {
      Punctuation: ['.', ',', '/', '-', '_'],
      toThaiNumerals: (str) => str.replace(/[0-9]/g, (d) => '‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô'[d]),
      addZeroWidthSpaces: (str) => str.split('').join('\u200B'),
      injectPunctuation: (str) => {
        const level = document.getElementById('obfuscationSelect').value;
        const chance = { low: 0, medium: 0.05, high: 0.15, extreme: 0.3 }[level] || 0;
        if (chance === 0 || !str) return str;
        let result = '';
        for (const char of str) {
          result += char;
          if (Math.random() < chance && char !== ' ' && !ObfuscationUtils.Punctuation.includes(char)) {
            result += ObfuscationUtils.Punctuation[Math.floor(Math.random() * ObfuscationUtils.Punctuation.length)];
          }
        }
        return result;
      },
      formatNumber: (num) => {
        if (!num) return '';
        const formats = [num, num.replace('/', ' / '), num.replace('/', '-'), `No.${num}`, num.split('').join(' ')];
        return formats[Math.floor(Math.random() * formats.length)];
      },
      formatPhone: (phone) => {
        if (!phone) return '';
        const formats = [phone, phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3'), phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1 $2 $3'), '+66 ' + phone.slice(1)];
        return formats[Math.floor(Math.random() * formats.length)];
      },
      generateVariationCode: () => 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[Math.floor(Math.random() * 26)] + '0123456789'[Math.floor(Math.random() * 10)]
    };

    // ==========================================
    // 3. ‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà (CORE LOGIC)
    // ==========================================

    function generateRandomAddress() {
      const startTime = Date.now();
      const level = document.getElementById('obfuscationSelect').value;
      const selectedAddress = ADDRESSES[CURRENT_ADDRESS_KEY];
      const selectedPhone = PHONES[CURRENT_ADDRESS_KEY];
      
      const isNewMode = (level === 'v1' || level === 'v2');
      const postal = (!isNewMode && Math.random() < 0.5) ? ObfuscationUtils.toThaiNumerals(selectedAddress.postalCode) : selectedAddress.postalCode;

      // --- Logic ‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡∏†‡∏≤‡∏©‡∏≤ (Thai vs English) ---
      // chance = 0.4 ‡∏Ñ‡∏∑‡∏≠‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™ 40% ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏±‡πâ‡∏ô‡πÜ
      function pickLang(thaiVal, engVal, type, chance = 0.4) {
        if (!engVal) return { value: thaiVal, isEng: false }; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏ó‡∏¢
        if (Math.random() < chance) {
           return { value: engVal, isEng: true };
        }
        return { value: thaiVal, isEng: false };
      }

      // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô (‡∏™‡∏∏‡πà‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÅ‡∏¢‡∏Å‡∏Å‡∏±‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏°)
      const roadData = pickLang(selectedAddress.road, selectedAddress.road_en, 'road');
      const subData = pickLang(selectedAddress.subdistrict, selectedAddress.subdistrict_en, 'subdistrict');
      const distData = pickLang(selectedAddress.district, selectedAddress.district_en, 'district');
      const provData = pickLang(selectedAddress.province, selectedAddress.province_en, 'province');

      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡πÄ‡∏£‡∏≤‡∏°‡∏±‡∏Å‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏Ç‡∏ß‡∏á/‡πÄ‡∏Ç‡∏ï) ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏™‡πà‡πÄ‡∏õ‡πá‡∏ô Comma ‡πÅ‡∏ó‡∏ô
      const getLabelPool = (originalPool, isEng) => {
         if(isEng) return ['']; // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© ‡πÉ‡∏´‡πâ Label ‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ (‡∏ù‡∏£‡∏±‡πà‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà ‡∏à./‡∏≠. ‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤)
         return originalPool;
      };

      const allComponents = [
        { type:'house', value: isNewMode ? selectedAddress.houseNumber : `<mark class="house-highlight">${ObfuscationUtils.formatNumber(selectedAddress.houseNumber)}</mark>`, labelPool: Labels.house, required: !!selectedAddress.houseNumber },
        { type:'phone', value: ObfuscationUtils.formatPhone(selectedPhone), labelPool: Labels.phone, required: !!selectedPhone },
        
        { type:'soi', value: selectedAddress.soi, labelPool: Labels.soi },
        
        // *** ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ï‡∏±‡πâ‡∏á required ‡πÄ‡∏õ‡πá‡∏ô true ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏≠‡∏û‡∏±‡∏Å/‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô (‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡∏≠‡∏á‡∏°‡∏¥‡πâ‡∏ô‡∏ó‡πå‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢) ***
        { type:'village', value: selectedAddress.village, labelPool: Labels.village, required: !!selectedAddress.village },
        
        // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡∏†‡∏≤‡∏©‡∏≤‡πÅ‡∏•‡πâ‡∏ß
        { type:'road', value: roadData.value, labelPool: getLabelPool(Labels.road, roadData.isEng) },
        { type:'subdistrict', value: subData.value, labelPool: getLabelPool(Labels.subdistrict, subData.isEng) },
        { type:'district', value: distData.value, labelPool: getLabelPool(Labels.district, distData.isEng) },
        { type:'province', value: provData.value, labelPool: getLabelPool(Labels.province, provData.isEng) },
        
        { type:'postal', value: postal, labelPool: Labels.postal }
      ].filter(c => c.value && String(c.value).replace(/<[^>]*>/g, '').trim() !== '');

      let componentsToUse;
      
      if (isNewMode) {
          // --- Logic V1/V2 ---
          const house = allComponents.find(c => c.type === 'house');
          const phone = allComponents.find(c => c.type === 'phone');
          const postal = allComponents.find(c => c.type === 'postal');
          // ‡πÄ‡∏≠‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏°‡∏≤‡∏£‡∏ß‡∏°‡∏Å‡∏±‡∏ô
          let others = allComponents.filter(c => c.type !== 'house' && c.type !== 'phone' && c.type !== 'postal');
          
          if (level === 'v2') {
              // V2: ‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏≠‡∏¢, ‡∏ñ‡∏ô‡∏ô, ‡∏´‡∏≠‡∏û‡∏±‡∏Å)
              others = others.sort(() => 0.5 - Math.random());
          }

          componentsToUse = [];
          if(house) componentsToUse.push(house);
          if(phone) componentsToUse.push(phone); // ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà
          componentsToUse = componentsToUse.concat(others);
          if(postal) componentsToUse.push(postal); // ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢

      } else {
          // --- Logic ‡πÄ‡∏î‡∏¥‡∏° (Low - Extreme) ---
          const required = allComponents.filter(c => c.required);
          const optional = allComponents.filter(c => !c.required);
          
          // ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô optional ‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ô‡∏≥‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á (‡πÅ‡∏ï‡πà village ‡πÄ‡∏õ‡πá‡∏ô required ‡πÅ‡∏•‡πâ‡∏ß ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏™‡∏∏‡πà‡∏°‡∏ó‡∏¥‡πâ‡∏á)
          const numOptionalToUse = Math.floor(Math.random() * (optional.length - 2)) + 3;
          
          componentsToUse = [...required, ...optional.sort(() => 0.5 - Math.random()).slice(0, numOptionalToUse)].sort(() => 0.5 - Math.random());
      }

      // ‡∏™‡∏£‡πâ‡∏≤‡∏á String ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢
      const formattedParts = componentsToUse.map(comp => {
        let labelPool = comp.labelPool;
        let label = labelPool[Math.floor(Math.random() * labelPool.length)];
        
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô Label ‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÑ‡∏´‡∏° (‡∏ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©) ‡∏ñ‡πâ‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ Fuzzy
        const isEnglishLabel = (label === ''); 

        if (!isNewMode && !isEnglishLabel && Math.random() < 0.4 && FuzzyLabels[comp.type]?.length > 0) {
          label = FuzzyLabels[comp.type][Math.floor(Math.random() * FuzzyLabels[comp.type].length)];
        }

        const showLabel = label && (comp.required || Math.random() > 0.3);
        const value = (comp.type === 'house' || isNewMode) ? comp.value : ObfuscationUtils.injectPunctuation(comp.value);
        
        let part = showLabel ? `${label} ${value}` : value;

        // ‡πÉ‡∏™‡πà Zero Width Space ‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î High/Extreme
        if (comp.type !== 'house' && !isNewMode){
          if (level === 'extreme' && Math.random() < 0.5) return ObfuscationUtils.addZeroWidthSpaces(part);
          if (level === 'high' && Math.random() < 0.3) return ObfuscationUtils.addZeroWidthSpaces(part);
        }
        return part.trim();
      });

      let lineStr = '';
      for (let i = 0; i < formattedParts.length; i++) {
        if (i > 0) {
          const sep = isNewMode ? '    ' : Separators[Math.floor(Math.random() * Separators.length)];
          lineStr += sep;
        }
        lineStr += formattedParts[i];
      }
      const result = lineStr;

      // ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
      const endTime = Date.now();
      const generationTime = endTime - startTime;
      const variationCode = ObfuscationUtils.generateVariationCode();

      document.getElementById('resultDisplay').innerHTML = result;
      document.getElementById('generationTime').textContent = `${generationTime}ms`;
      document.getElementById('currentVariation').textContent = variationCode;

      stats.generateCount++;
      document.getElementById('generateCount').textContent = stats.generateCount;
      const obfuscationIcons = { v1:'‚ú®', v2:'‚ö°', low: 'üü¢', medium: 'üü°', high: 'üî¥', extreme: '‚ö´' };
      document.getElementById('obfuscationLevel').textContent = obfuscationIcons[level] || 'üîí';
      history.unshift({ result: result.replace(/<[^>]*>/g, ''), time: new Date().toLocaleTimeString('th-TH'), variation: variationCode });
      if (history.length > 5) history.pop();
      updateHistoryDisplay();
    }

    // ==========================================
    // 4. ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ UI (UI HANDLERS)
    // ==========================================

    function updateHistoryDisplay() {
      const container = document.getElementById('historyContainer');
      if (history.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>';
        return;
      }
      container.innerHTML = history.map((item, index) => `
        <div class="bg-gray-800 p-3 rounded-lg text-sm">
          <div class="flex justify-between items-center mb-2">
            <span class="text-purple-400 font-mono">${item.variation}</span>
            <span class="text-gray-400">${item.time}</span>
          </div>
          <div class="text-gray-300 text-xs whitespace-pre-wrap">${item.result}</div>
        </div>
      `).join('');
    }

    function copyToClipboard() {
      const resultText = document.getElementById('resultDisplay').textContent;
      if (!resultText.trim()) {
        alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      navigator.clipboard.writeText(resultText).then(() => {
        stats.copyCount++;
        document.getElementById('copyCount').textContent = stats.copyCount;
        showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!');
      }).catch(err => {
        console.error('Failed to copy: ', err);
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ');
      });
    }

    function clearResult() {
      document.getElementById('resultDisplay').innerHTML = '';
      document.getElementById('generationTime').textContent = '';
      document.getElementById('currentVariation').textContent = 'A1';
      document.getElementById('obfuscationLevel').textContent = 'üîí';
    }

    function generateNew() { generateRandomAddress(); }
    
    document.getElementById('generateBtn').addEventListener('click', generateNew);
    document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
    document.getElementById('clearBtn').addEventListener('click', clearResult);

    generateNew();
  })();
  </script>
