<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All-in-One Tools ‚Äî Reskin (Auto Parse + New Modes)</title>
  
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg: #0b1220;
      --bg-2: #0f172a;
      --surface: #121a2b;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --primary: #60a5fa;
      --primary-strong: #3b82f6;
      --accent: #8b5cf6;
      --success: #22c55e;
      --danger: #ef4444;
      --card-border: rgba(148,163,184,.18);
      --soft-shadow: 0 10px 24px rgba(2,6,23,.35);
      --inner: inset 0 1px 0 rgba(255,255,255,.03);
      --radius: 16px;
    }

    body{
      font-family: 'Sarabun', system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px 600px at 10% -10%, #0f1a33 0%, transparent 60%),
        radial-gradient(800px 500px at 110% 10%, #101c3a 0%, transparent 55%),
        var(--bg);
      min-height: 100vh;
    }

    /* Nav Tabs */
    .tab-button{ color:#a3adc2; border:1px solid transparent; background: transparent;
      transition: all .2s ease; }
    .tab-button:hover{ color:#e5e7eb; background: rgba(255,255,255,.04); border-color: rgba(148,163,184,.2); }
    .tab-button.active-tab{ color:#0b1220;
      background: linear-gradient(135deg, var(--primary), var(--accent)); border-color: transparent; box-shadow: 0 8px 20px rgba(59,130,246,.30);
    }

    /* Cards */
    .panel{ background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)); border:1px solid var(--card-border); border-radius: var(--radius);
      box-shadow: var(--soft-shadow), var(--inner); }
    .stats-card{ background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid var(--card-border); border-radius: 12px; box-shadow: var(--inner);
    }

    /* Result */
    .result-box{ position: relative; overflow: hidden; background: var(--surface); border:1px solid var(--card-border);
      border-radius: var(--radius); box-shadow: var(--soft-shadow), var(--inner); }
    .result-box::before{ content:""; position:absolute; inset:0; background: linear-gradient(90deg, transparent, rgba(96,165,250,.09), transparent); transform: translateX(-100%);
      animation: shimmer 3.5s infinite; }
    @keyframes shimmer{ 0%{ transform: translateX(-100%) } 100%{ transform: translateX(100%) }}
    pre#resultDisplay{ font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      color:#c7d2fe; line-height:1.7; }
    
    /* Highlight styles inside result */
    .house-highlight { background: rgba(59, 130, 246, 0.2);
      color: #93c5fd; padding: 0 4px; border-radius: 4px; }

    /* Buttons */
    .btn{ border:1px solid var(--card-border);
      border-radius: 12px; padding: 10px 16px; font-weight:700; transition: transform .05s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
      cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 6px; }
    .btn:active{ transform: translateY(1px);
    }
    .btn-primary{ color:#0b1220; background: linear-gradient(135deg, var(--primary), var(--accent)); border-color: transparent; box-shadow: 0 10px 24px rgba(99,102,241,.25);
    }
    .btn-primary:hover{ filter: brightness(1.02); box-shadow: 0 14px 28px rgba(99,102,241,.3) }
    .btn-secondary{ color:#0b1220;
      background: linear-gradient(135deg, #34d399, #10b981); border-color: transparent; box-shadow: 0 10px 24px rgba(16,185,129,.22);
    }
    .btn-secondary:hover{ filter: brightness(1.03) }
    .btn-danger{ color:#fff; background: #dc2626;
      border-color: rgba(239,68,68,.6) }
    .btn-danger:hover{ background:#ef4444 }
    .btn-ghost{ color:#9ca3af; background: transparent; border-color: transparent;
    }
    .btn-ghost:hover{ color:#e5e7eb; background: rgba(255,255,255,0.05); }

    /* Toast & Modal */
    #toast{ background: linear-gradient(90deg, var(--primary), var(--accent));
      box-shadow: 0 10px 30px rgba(59,130,246,.35); color:#0b1220; border-radius: 12px; }
    
    /* Custom Modal */
    .modal-backdrop { background-color: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px); }
    .modal-content { background: #16223a; border: 1px solid var(--card-border); box-shadow: 0 20px 50px rgba(0,0,0,0.5);
      animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes modalPop { 0% { opacity: 0;
      transform: scale(0.9) translateY(10px); } 100% { opacity: 1; transform: scale(1) translateY(0);
    } }

    /* Board message card */
    .gradient-border{ border-radius: 14px; border:1px solid var(--card-border);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); box-shadow: var(--inner); }
    .pinned-message { border: 2px solid var(--primary); background: linear-gradient(180deg, rgba(96,165,250,.1), rgba(96,165,250,.05));
    }

    /* Email Card Specific */
    .email-card { position: relative; overflow: hidden; transition: all 0.3s ease; }
    .email-field { background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 8px 12px; display: flex;
      align-items: center; justify-content: space-between; }
    .password-dot { font-family: sans-serif; letter-spacing: 2px; font-size: 1.2rem; line-height: 1; color: var(--muted);
    }
    
    /* Email Status Styles */
    .email-status-good { border: 1px solid rgba(34, 197, 94, 0.5); box-shadow: 0 0 15px rgba(34, 197, 94, 0.1); }
    .email-status-warning { border: 1px solid rgba(234, 179, 8, 0.5); box-shadow: 0 0 15px rgba(234, 179, 8, 0.1); }
    .email-status-expired { border: 1px solid rgba(75, 85, 99, 0.5); background: rgba(17, 24, 39, 0.8); opacity: 0.7; filter: grayscale(0.8); }

    /* Custom Radio for Days */
    .day-selector input[type="radio"] { display: none; }
    .day-selector label {
        cursor: pointer; padding: 6px 12px; border-radius: 8px; border: 1px solid var(--card-border);
        background: rgba(255,255,255,0.05); color: var(--muted); transition: all 0.2s; font-size: 0.9rem;
    }
    .day-selector input[type="radio"]:checked + label {
        background: var(--primary); color: #0b1220; border-color: var(--primary); font-weight: bold;
    }

    /* Quick Paste Area */
    .quick-paste-area {
        background: rgba(16, 185, 129, 0.05);
        border: 1px dashed rgba(16, 185, 129, 0.3);
        transition: all 0.2s;
    }
    .quick-paste-area:focus {
        background: rgba(16, 185, 129, 0.1);
        border-color: rgba(16, 185, 129, 0.6);
        outline: none;
    }

    /* Matrix BG */
    .matrix-bg{ position:fixed;
      inset:0; width:100vw; height:100vh; z-index:-1; opacity:.06; pointer-events:none; }

    /* Utility */
    .text-gray-400{ color: var(--muted) }
    .bg-gray-800{ background-color: #101a2c }
    .bg-gray-700{ background-color: #16223a }
    .bg-gray-900\/50{ background-color: rgba(2,6,23,.5) }
    .hidden { display: none !important; }
  </style>
</head>
<body class="text-gray-200">
  <canvas class="matrix-bg" id="matrixCanvas"></canvas>
  <div id="toast" class="fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-10 z-50 transition-all duration-300">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!</div>

  <div id="confirmModal" class="fixed inset-0 z-[100] flex items-center justify-center hidden modal-backdrop">
    <div class="modal-content rounded-2xl p-6 max-w-sm w-full mx-4 text-center">
      <div class="mb-4 text-red-400 text-5xl">‚ö†Ô∏è</div>
      <h3 class="text-xl font-bold text-white mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?</h3>
      <p class="text-gray-400 text-sm mb-6">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ<br>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
      <div class="flex gap-3 justify-center">
        <button id="modalCancelBtn" class="btn btn-ghost w-1/2">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button id="modalConfirmBtn" class="btn btn-danger w-1/2 shadow-red-900/50 shadow-lg">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö</button>
      </div>
    </div>
  </div>

  <div id="editModal" class="fixed inset-0 z-[100] flex items-center justify-center hidden modal-backdrop">
    <div class="modal-content rounded-2xl p-6 max-w-lg w-full mx-4">
      <h3 class="text-xl font-bold text-white mb-4 text-center">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
      
      <div class="space-y-4">
        <div>
            <label class="block text-sm text-cyan-200 mb-1">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ / ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å</label>
            <input id="editTitleInput" type="text" class="w-full p-2 bg-[#0b1220] border border-gray-600 rounded-lg text-white focus:border-cyan-400 focus:outline-none" />
        </div>
        
        <div id="editMessageContainer">
            <label class="block text-sm text-cyan-200 mb-1">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</label>
            <textarea id="editMessageInput" rows="5" class="w-full p-2 bg-[#0b1220] border border-gray-600 rounded-lg text-white focus:border-cyan-400 focus:outline-none"></textarea>
        </div>

        <div id="editEmailContainer" class="hidden space-y-3">
             <div>
                <label class="block text-sm text-cyan-200 mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏• / Username</label>
                <input id="editEmailField" type="text" class="w-full p-2 bg-[#0b1220] border border-gray-600 rounded-lg text-white focus:border-cyan-400 focus:outline-none" />
             </div>
             <div>
                <label class="block text-sm text-cyan-200 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                <div class="relative">
                    <input id="editPasswordField" type="text" class="w-full p-2 bg-[#0b1220] border border-gray-600 rounded-lg text-white focus:border-cyan-400 focus:outline-none" />
                    <span class="absolute right-3 top-2.5 text-xs text-gray-500">Visible</span>
                </div>
             </div>
        </div>
      </div>

      <div class="flex gap-3 justify-end mt-6">
        <button id="editCancelBtn" class="btn btn-ghost">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button id="editSaveBtn" class="btn btn-primary shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      </div>
    </div>
  </div>

  <div class="container mx-auto max-w-6xl p-4 sm:p-6 lg:p-8">

    <nav class="flex flex-wrap justify-center items-center gap-2 md:gap-4 mb-8 bg-gray-900/50 p-2 rounded-xl backdrop-blur-sm panel">
      <button id="btn-address-tab" class="tab-button font-bold py-2 px-4 md:px-6 rounded-lg text-sm md:text-base">üîê ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏±‡∏ö</button>
      <button id="btn-board-tab" class="tab-button font-bold py-2 px-4 md:px-6 rounded-lg text-sm md:text-base">üí¨ ‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
      <button id="btn-email-tab" class="tab-button font-bold py-2 px-4 md:px-6 rounded-lg text-sm md:text-base">üìß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏µ‡πÄ‡∏°‡∏•</button>
    </nav>

    <main>
      <section id="address-tab">
        <div class="text-center mb-8">
          <h1 class="text-3xl md:text-5xl font-bold bg-clip-text text-transparent mb-4" style="background-image: linear-gradient(90deg, var(--primary), var(--accent));">üîê ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏±‡∏ö</h1>
          <p class="text-gray-400 text-sm md:text-lg mb-4">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß</p>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="stats-card p-4 text-center"><div class="text-xl md:text-2xl font-bold text-blue-400" id="generateCount">0</div><div class="text-xs text-gray-400">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</div></div>
          <div class="stats-card p-4 text-center"><div class="text-xl md:text-2xl font-bold text-green-400" id="copyCount">0</div><div class="text-xs text-gray-400">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</div></div>
          <div class="stats-card p-4 text-center"><div class="text-xl md:text-2xl font-bold text-purple-400" id="currentVariation">A1</div><div class="text-xs text-gray-400">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div></div>
          <div class="stats-card p-4 text-center"><div class="text-xl md:text-2xl font-bold text-yellow-400" id="obfuscationLevel">üîí</div><div class="text-xs text-gray-400">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏≤‡∏á</div></div>
        </div>

        <div class="result-box p-6 mb-6 relative">
           <div class="absolute top-4 right-4 text-xs text-gray-500" id="generationTime"></div>
           <pre id="resultDisplay" class="text-sm md:text-base leading-relaxed whitespace-pre-wrap min-h-[150px] overflow-x-auto"></pre>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
          <button id="generateBtn" class="btn btn-primary text-lg">üé≤ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</button>
          <button id="copyBtn" class="btn btn-secondary text-lg">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          <button id="clearBtn" class="btn btn-danger text-lg">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>

        <div class="panel rounded-xl p-6 mb-6">
          <h3 class="text-xl font-bold mb-4 text-center">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="addressSelect" class="block text-sm font-medium mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
              <select id="addressSelect" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label for="obfuscationSelect" class="block text-sm font-medium mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß</label>
              <select id="obfuscationSelect" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm"></select>
            </div>
          </div>
        </div>

       <div class="panel rounded-xl p-6">
           <h3 class="text-xl font-bold mb-4 text-center">üìö ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á (5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h3>
          <div id="historyContainer" class="space-y-2 max-h-60 overflow-y-auto">
            <div class="text-center text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
          </div>
         </div>
      </section>

      <section id="board-tab" class="hidden">
        <header class="text-center mb-8 py-8 rounded-2xl panel">
          <h1 class="text-3xl sm:text-4xl font-bold" style="background-image: linear-gradient(90deg, var(--primary), var(--accent));
-webkit-background-clip:text; background-clip:text; color: transparent;">‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</h1>
          <p class="text-gray-200 mt-2">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
          <div class="mt-4 text-sm" style="color:#93c5fd"><span>ID ‡∏ö‡∏≠‡∏£‡πå‡∏î: </span><span id="board-id-display" class="font-mono bg-gray-800 p-1 rounded shadow-inner"></span></div>
        </header>

        <div class="p-6 rounded-2xl shadow-2xl mb-8 gradient-border">
          <form id="message-form">
            <label for="title-input" class="block text-lg font-semibold mb-2" style="color:#93c5fd">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠/‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</label>
             <input id="title-input" type="text" class="w-full p-3 mb-3 bg-[#16223a] text-cyan-200 border border-cyan-700 focus:border-cyan-400 focus:ring-0 rounded-lg transition placeholder:text-cyan-700" placeholder="‡πÉ‡∏™‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå..." />
            <label for="message-input" class="block text-lg font-semibold mb-2" style="color:#93c5fd">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
            <textarea id="message-input" rows="4" class="w-full p-3 bg-[#16223a] text-cyan-100 border border-cyan-700 focus:border-cyan-400 focus:ring-0 rounded-lg transition placeholder:text-cyan-700" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
            <button type="submit" id="post-button" class="mt-4 w-full btn btn-primary">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
          </form>
        </div>

          <div id="messages-container" class="space-y-4">
          </div>
      </section>
      
      <section id="email-tab" class="hidden">
        <header class="text-center mb-8 py-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-white mb-2">üìß ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏µ‡πÄ‡∏°‡∏•</h1>
            <p class="text-gray-400">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏ß‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô)</p>
        </header>

        <div class="p-6 rounded-2xl shadow-2xl mb-8 gradient-border">
            <div class="mb-6 p-4 bg-emerald-900/20 border border-emerald-500/30 rounded-xl">
                <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-bold text-emerald-400">‚ö° ‡∏ß‡∏≤‡∏á‡πÇ‡∏Ñ‡πâ‡∏î‡∏î‡πà‡∏ß‡∏ô (Email|Pass)</label>
                    <button id="btn-paste-clipboard" class="text-xs bg-emerald-600 text-white px-3 py-1.5 rounded-lg hover:bg-emerald-500 transition-colors shadow-lg flex items-center gap-1 border border-emerald-400/50">
                        üìã ‡∏ß‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô (Paste)
                    </button>
                </div>
                <textarea id="quick-paste-input" rows="2" class="quick-paste-area w-full p-3 text-emerald-100 rounded-lg placeholder-emerald-700/50" placeholder="‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÄ‡∏ä‡πà‡∏ô: tongocphunguo14@school.us|Phan9999"></textarea>
                 <div class="text-xs text-emerald-500/70 mt-1 text-right">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÅ‡∏¢‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</div>
            </div>

            <h3 class="text-lg font-bold mb-4 text-cyan-300">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="email-form" class="flex flex-col gap-3">
                <input id="email-title-input" type="text" class="w-full p-3 bg-[#16223a] text-white border border-gray-700 rounded-lg focus:border-cyan-400 focus:outline-none" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏™‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô ‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)" />
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                     <input id="email-addr-input" type="text" class="w-full p-3 bg-[#16223a] text-white border border-gray-700 rounded-lg focus:border-cyan-400 focus:outline-none" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏• / Username" required />
                    <input id="email-pass-input" type="text" class="w-full p-3 bg-[#16223a] text-white border border-gray-700 rounded-lg focus:border-cyan-400 focus:outline-none" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)" required />
                </div>

                <div class="flex flex-wrap items-center gap-2 py-2">
                    <span class="text-sm text-gray-400">‚è≥ ‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏°‡∏•:</span>
                    <div class="day-selector flex gap-2">
                        <input type="radio" name="email-life" id="life-1" value="1">
                        <label for="life-1">1 ‡∏ß‡∏±‡∏ô</label>
                        
                        <input type="radio" name="email-life" id="life-2" value="2">
                        <label for="life-2">2 ‡∏ß‡∏±‡∏ô</label>

                        <input type="radio" name="email-life" id="life-3" value="3">
                        <label for="life-3">3 ‡∏ß‡∏±‡∏ô</label>

                        <input type="radio" name="email-life" id="life-4" value="4">
                        <label for="life-4">4 ‡∏ß‡∏±‡∏ô</label>

                        <input type="radio" name="email-life" id="life-5" value="5" checked>
                        <label for="life-5">5 ‡∏ß‡∏±‡∏ô</label>
                    </div>
                </div>
        
                <button type="submit" class="mt-2 w-full btn btn-primary">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
              </form>
        </div>

        <div id="loading-state" class="text-center py-10 hidden"><p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p></div>
        
        <div id="emails-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            </div>
      </section>

    </main>
  </div>

  <script>
    // Tab Switching Logic
    document.addEventListener('DOMContentLoaded', () => {
      const tabs = document.querySelectorAll('main > section');
      const buttons = document.querySelectorAll('nav button');
      function switchTab(tabId) {
        tabs.forEach(tab => tab.classList.add('hidden'));
        const activeTab = document.getElementById(tabId);
        if (activeTab) activeTab.classList.remove('hidden');
        buttons.forEach(button => button.classList.remove('active-tab'));
        const activeButton = document.getElementById(`btn-${tabId}`);
        if (activeButton) activeButton.classList.add('active-tab');
      }
      buttons.forEach(button => button.addEventListener('click', () => switchTab(button.id.replace('btn-',''))));
      // Default Tab
      switchTab('address-tab');
    });
  </script>

  <script>
  (() => {
    // 1. DATA CONFIGURATION
    const ADDRESSES = {
      home: { 
        houseNumber: "82/7", soi: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á16", village: "‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£2", 
        road: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", road_en: "Lat Krabang Rd.",
        subdistrict: "‡∏£‡∏≤‡∏ä‡∏≤‡πÄ‡∏ó‡∏ß‡∏∞", subdistrict_en: "Racha Thewa",
        district: "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ", district_en: "Bang Phli",
        province: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", province_en: "Samut Prakan",
        postalCode: "10540" 
      },
      alt1: { 
        houseNumber: "22/4", soi: "‡πÉ‡∏à‡πÄ‡∏≠‡∏∑‡πâ‡∏≠ 2", village: "", road: "", 
        subdistrict: "‡∏ö‡∏≤‡∏á‡∏Ç‡∏∞‡πÅ‡∏¢‡∏á", subdistrict_en: "Bang Khayaeng",
        district: "‡πÄ‡∏°‡∏∑‡∏≠‡∏á", district_en: "Mueang",
        province: "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", province_en: "Pathum Thani",
        postalCode: "12000" 
      },
      nack: { 
        houseNumber: "42/3", soi: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á14/1", village: "‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏≠‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏°‡∏ô", road: "", 
        subdistrict: "‡∏£‡∏≤‡∏ä‡∏≤‡πÄ‡∏ó‡∏ß‡∏∞", subdistrict_en: "Racha Thewa",
        district: "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ", district_en: "Bang Phli",
        province: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", province_en: "Samut Prakan",
        postalCode: "10540" 
      },
      mint: { 
         houseNumber: "1400", soi: "‡∏≠‡πà‡∏≠‡∏ô‡∏ô‡∏∏‡∏ä 42", 
        village: "‡∏´‡∏≠‡∏û‡∏±‡∏Å‡∏ß‡∏á‡∏®‡πå‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏û‡∏£ ‡πÅ‡∏°‡∏ô‡∏ä‡∏±‡πà‡∏ô", 
        road: "‡∏≠‡πà‡∏≠‡∏ô‡∏ô‡∏∏‡∏ä", road_en: "On Nut Rd.",
        subdistrict: "‡∏™‡∏ß‡∏ô‡∏´‡∏•‡∏ß‡∏á", subdistrict_en: "Suan Luang",
        district: "‡∏™‡∏ß‡∏ô‡∏´‡∏•‡∏ß‡∏á", district_en: "Suan Luang",
        province: "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", province_en: "Bangkok",
        postalCode: "10250" 
      },
      first: { 
        houseNumber: "1008", soi: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á 34/6", village: "‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô ‡∏ö.‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡πÄ‡∏î‡πâ‡∏ô‡∏ó‡πå", 
        road: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", road_en: "Lat Krabang Rd.",
        subdistrict: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", subdistrict_en: "Lat Krabang",
        district: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", district_en: "Lat Krabang",
        province: "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", province_en: "Bangkok",
        postalCode: "10520" 
      }
    };
    const PHONES = { 
      home: "0951698770", alt1: "0946401569", nack: "0820571500", mint: "0959936570", first:"0993353499" 
    };
    let CURRENT_ADDRESS_KEY = 'home';

    const addressSelect = document.getElementById('addressSelect');
    if(addressSelect) {
      addressSelect.innerHTML = 
        '<option value="home">‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£</option>' + 
        '<option value="alt1">‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏ó‡∏∏‡∏°</option>' +
        '<option value="nack">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ô‡πâ‡∏Ñ</option>' +
        '<option value="mint">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏°‡∏¥‡∏ô‡∏ó‡πå</option>' +
        '<option value="first">üìç ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏ü‡∏¥‡∏£‡πå‡∏™</option>';
    }
      
    const obfuscationSelect = document.getElementById('obfuscationSelect');
    if(obfuscationSelect) {
      obfuscationSelect.innerHTML = 
        '<option value="v1">‚ú® V.1 (‡πÄ‡∏ô‡πâ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢/‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏£‡∏£‡∏Ñ)</option>' +
        '<option value="v2">‚ö° V.2 (‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏™‡∏∏‡πà‡∏°‡∏ß‡∏£‡∏£‡∏Ñ)</option>' +
        '<option value="v3">üå™Ô∏è V.3 (‡πÄ‡∏•‡∏Ç‡∏ú‡∏™‡∏°‡πÑ‡∏ó‡∏¢-‡∏≠‡∏≤/Noise)</option>' +
        '<option value="v4">‚ò†Ô∏è V.4 (Human Error/Typo/Chaos)</option>' +
        '<option value="low">üü¢ ‡∏ï‡πà‡∏≥ - ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</option>' +
        '<option value="medium" selected>üü° ‡∏Å‡∏•‡∏≤‡∏á - ‡∏™‡∏°‡∏î‡∏∏‡∏•</option>' +
        '<option value="high">üî¥ ‡∏™‡∏π‡∏á - ‡∏û‡∏£‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏Å</option>' +
        '<option value="extreme">‚ö´ ‡∏™‡∏∏‡∏î‡∏Ç‡∏±‡πâ‡∏ô - ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å</option>';
    }

    if(addressSelect) {
        addressSelect.addEventListener('change', (e) => { CURRENT_ADDRESS_KEY = e.target.value; generateNew(); });
    }

    let stats = { generateCount: 0, copyCount: 0 };
    let history = [];
    // 2. UTILS
    const Labels = {
      house: ['‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô', 'House No.', 'Address No.', 'Addr. No.', 'Unit', '#', ''],
      phone: ['‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', '‡πÇ‡∏ó‡∏£', '‡πÄ‡∏ö‡∏≠‡∏£‡πå', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£', 'Tel', 'Tel.', 'Mobile', 'Contact', 'Contact No.', ''],
      soi: ['‡∏ã‡∏≠‡∏¢', '‡∏ã.', 'Soi', ''],
      village: ['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô', '‡∏°.', '‡∏´‡∏°‡∏π‡πà', ''],
      road: ['‡∏ñ‡∏ô‡∏ô', '‡∏ñ.', 'Rd.', ''],
      subdistrict: ['‡∏ï‡∏≥‡∏ö‡∏•', '‡∏ï.', '‡πÅ‡∏Ç‡∏ß‡∏á'],
      district: ['‡∏≠‡∏≥‡πÄ‡∏†‡∏≠', '‡∏≠.', '‡πÄ‡∏Ç‡∏ï'],
      province: ['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '‡∏à.', ''],
      postal: ['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±‡∏™', 'Zip', '']
    };
    const FuzzyLabels = {
      house: ['‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡πÖ‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏ã‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤‡∏ô‡πÄx‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤u‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πÖ‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡πÖ‡∏ô‡πÄ‡∏•x‡∏ó‡∏µ‡πà', '‡∏ö‡∏≤u‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', 'l‡∏ö‡πÖ‡∏ô‡πÄ‡∏•‡∏Ç', 'H0use No.', 'H‡πêuse', 'Addr. No.', 'L‡∏ö‡πâ‡∏≤‡∏ô'],
      phone: ['‡πÇ‡∏ós‡∏±‡∏û‡∏ó‡πå', '‡πÇ‡∏ó‡∏£s‡∏±s‡∏ó‡πå', '‡πÇ‡∏óp‡∏®‡∏±‡∏û', '‡πÇ‡∏ó‡∏£s‡∏±‡∏ö', '‡πÄbo‡∏£‡πå', 'l‡πÄ‡∏öo‡∏£‡πå', '‡πÄb‡∏≠‡∏£‡πå', '‡πÇ‡∏ós', 'T‚ÑÆl', 'Mob1le', 'C0ntact', 'Tel.'],
      soi: ['‡∏ão‡∏¢', '‡∏ãx‡∏¢', '‡∏ã0‡∏¢'],
      village: ['‡∏´‡∏°‡∏π‡πà‡∏ö‡∏≤u', '‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤u', '‡∏´‡∏°‡∏πv‡∏ö‡∏≤u'],
      road: ['‡∏ñu‡∏ô', '‡∏ñuv', '‡∏ñv‡∏ô'],
      subdistrict: ['‡∏ï‡∏≥‡∏öu', '‡∏ï‡πç‡∏≤‡∏ö‡∏•', '‡∏ïx‡∏ö‡∏•'],
      district: ['‡∏≠‡∏≥p‡∏≠', '‡∏≠‡∏≥‡πÄ‡πÖ‡∏≠', '‡∏≠‡πç‡∏≤‡πÄ‡∏†o'],
      province: ['‡∏à‡∏±‡∏á‡∏´‡∏ß‡πâ‡∏î', '‡∏à‡∏±n‡∏´‡∏ß‡∏±‡∏î', '‡∏à‡∏±J‡∏´‡∏ß‡∏±‡∏î'],
      postal: ['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õs‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±n‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±‡∏™‡πÑp‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå']
    };
    const Separators = [', ', ' ', '  ', '   ', '. ', ' - '];
    const ObfuscationUtils = {
      Punctuation: ['.', ',', '/', '-', '_', '|', ':', '~'],
      
      toThaiNumerals: (str) => str.replace(/[0-9]/g, (d) => '‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô'[d]),
      
      // Mixes Arabic and Thai Numerals randomly (For V3)
      mixNumerals: (str) => {
        return str.replace(/[0-9]/g, (d) => {
            return Math.random() < 0.5 ? '‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô'[d] : d;
        });
      },

      addZeroWidthSpaces: (str) => str.split('').join('\u200B'),
      
      injectPunctuation: (str) => {
        const level = document.getElementById('obfuscationSelect').value;
        const chance = { low: 0, medium: 0.05, high: 0.15, extreme: 0.3, v3: 0.1, v4: 0.2 }[level] || 0;
        if (chance === 0 || !str) return str;
        let result = '';
        for (const char of str) {
          result += char;
          if (Math.random() < chance && char !== ' ' && !ObfuscationUtils.Punctuation.includes(char)) {
            result += ObfuscationUtils.Punctuation[Math.floor(Math.random() * ObfuscationUtils.Punctuation.length)];
          }
        }
        return result;
      },

      // Adds garbage strings (For V3)
      addNoise: (str) => {
          if (!str || str.length < 3) return str;
          const noises = ['(Ref)', '[#]', '-', '.', '*', '`', '::', 'Zone'];
          if(Math.random() < 0.3) {
             const noise = noises[Math.floor(Math.random() * noises.length)];
             return Math.random() < 0.5 ? `${noise} ${str}` : `${str} ${noise}`;
          }
          return str;
      },

      formatNumber: (num) => {
        if (!num) return '';
        const formats = [num, num.replace('/', ' / '), num.replace('/', '-'), `No.${num}`, num.split('').join(' ')];
        return formats[Math.floor(Math.random() * formats.length)];
      },
      formatPhone: (phone) => {
        if (!phone) return '';
        const formats = [phone, phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3'), phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1 $2 $3'), '+66 ' + phone.slice(1)];
        return formats[Math.floor(Math.random() * formats.length)];
      },
      generateVariationCode: () => 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[Math.floor(Math.random() * 26)] + '0123456789'[Math.floor(Math.random() * 10)],
      
      getRandomSpacing: () => {
         const count = Math.floor(Math.random() * 4) + 2;
         return ' '.repeat(count);
      }
    };

    // 3. CORE LOGIC
    function generateRandomAddress() {
      const startTime = Date.now();
      const levelElement = document.getElementById('obfuscationSelect');
      const level = levelElement ? levelElement.value : 'medium';
      
      const selectedAddress = ADDRESSES[CURRENT_ADDRESS_KEY];
      const selectedPhone = PHONES[CURRENT_ADDRESS_KEY];
      const isModernMode = ['v1', 'v2', 'v3', 'v4'].includes(level);
      
      // Determine Postal Code Format
      let postal = selectedAddress.postalCode;
      if (level === 'v3') {
          postal = ObfuscationUtils.mixNumerals(postal);
      } else if (!isModernMode && Math.random() < 0.5) {
          postal = ObfuscationUtils.toThaiNumerals(postal);
      }

      // Determine Phone Format
      let phoneVal = ObfuscationUtils.formatPhone(selectedPhone);
      if (level === 'v3') {
          phoneVal = ObfuscationUtils.mixNumerals(phoneVal);
      }

      function pickLang(thaiVal, engVal, type, chance = 0.4) {
        if (!engVal) return { value: thaiVal, isEng: false };
        if (Math.random() < chance) return { value: engVal, isEng: true };
        return { value: thaiVal, isEng: false };
      }

      const roadData = pickLang(selectedAddress.road, selectedAddress.road_en, 'road');
      const subData = pickLang(selectedAddress.subdistrict, selectedAddress.subdistrict_en, 'subdistrict');
      const distData = pickLang(selectedAddress.district, selectedAddress.district_en, 'district');
      const provData = pickLang(selectedAddress.province, selectedAddress.province_en, 'province');
      const getLabelPool = (originalPool, isEng) => { if(isEng) return ['']; return originalPool; };
      // Component construction
      let houseVal = selectedAddress.houseNumber;
      if (isModernMode) {
          // Keep raw or lightly formatted for modern modes, except V3 can mix numerals
          houseVal = (level === 'v3') ?
             ObfuscationUtils.mixNumerals(ObfuscationUtils.formatNumber(houseVal)) : houseVal;
          // V4 might add noise or format weirdly
          if (level === 'v4') houseVal = ObfuscationUtils.injectPunctuation(houseVal);
      } else {
          houseVal = `<mark class="house-highlight">${ObfuscationUtils.formatNumber(houseVal)}</mark>`;
      }

      const allComponents = [
        { type:'house', value: houseVal, labelPool: Labels.house, required: !!selectedAddress.houseNumber },
        { type:'phone', value: phoneVal, labelPool: Labels.phone, required: !!selectedPhone },
        { type:'soi', value: selectedAddress.soi, labelPool: Labels.soi },
        { type:'village', value: selectedAddress.village, labelPool: Labels.village, required: !!selectedAddress.village },
        { type:'road', value: roadData.value, labelPool: getLabelPool(Labels.road, roadData.isEng) },
        { type:'subdistrict', value: subData.value, labelPool: getLabelPool(Labels.subdistrict, subData.isEng) },
        { type:'district', value: distData.value, labelPool: getLabelPool(Labels.district, distData.isEng) },
        { type:'province', value: provData.value, labelPool: getLabelPool(Labels.province, provData.isEng) },
        { type:'postal', value: postal, labelPool: Labels.postal }
      ].filter(c => c.value && String(c.value).replace(/<[^>]*>/g, '').trim() !== '');
      let componentsToUse;
      if (isModernMode) {
          const house = allComponents.find(c => c.type === 'house');
          const phone = allComponents.find(c => c.type === 'phone');
          const postal = allComponents.find(c => c.type === 'postal');
          let others = allComponents.filter(c => c.type !== 'house' && c.type !== 'phone' && c.type !== 'postal');
          if (level === 'v2' || level === 'v4') {
             // Scramble middle parts
             others = others.sort(() => 0.5 - Math.random());
          }
          
          componentsToUse = [];
          if(house) componentsToUse.push(house);
          
          // Randomize Phone position in V2/V4
          if((level === 'v2' || level === 'v4') && Math.random() > 0.5) {
              componentsToUse = componentsToUse.concat(others);
              if(phone) componentsToUse.push(phone);
          } else {
              if(phone) componentsToUse.push(phone);
              componentsToUse = componentsToUse.concat(others);
          }
          if(postal) componentsToUse.push(postal);
      } else {
          const required = allComponents.filter(c => c.required);
          const optional = allComponents.filter(c => !c.required);
          const numOptionalToUse = Math.floor(Math.random() * (optional.length - 2)) + 3;
          componentsToUse = [...required, ...optional.sort(() => 0.5 - Math.random()).slice(0, numOptionalToUse)].sort(() => 0.5 - Math.random());
      }

      const formattedParts = componentsToUse.map(comp => {
        let labelPool = comp.labelPool;
        let label = labelPool[Math.floor(Math.random() * labelPool.length)];
        const isEnglishLabel = (label === ''); 

        // Fuzzy Logic: Normal (40% chance), V4 (100% chance for Typo/Fuzzy)
        const useFuzzy = (level === 'v4') || (!isModernMode && !isEnglishLabel && Math.random() < 0.4);
        
        if (useFuzzy && FuzzyLabels[comp.type]?.length > 0) {
          label = FuzzyLabels[comp.type][Math.floor(Math.random() * FuzzyLabels[comp.type].length)];
        }

        const showLabel = label && (comp.required || Math.random() > 0.3 || level === 'v4');
        let value = comp.value;

        // V3: Add Noise/Junk
        if (level === 'v3') {
            value = ObfuscationUtils.addNoise(value);
        }

        // Punctuation Injection
        if (comp.type !== 'house' && !isModernMode) {
            value = ObfuscationUtils.injectPunctuation(value);
        } else if (level === 'v4') {
             value = ObfuscationUtils.injectPunctuation(value);
        }

        let part = '';
        // V4: Randomly swap Label and Value (e.g., "Lat Krabang Road" -> "Road Lat Krabang")
        if (level === 'v4' && showLabel && Math.random() < 0.3) {
             part = `${value} ${label}`;
        } else {
             part = showLabel ? `${label} ${value}` : value;
        }

        if (comp.type !== 'house' && !isModernMode){
          if (level === 'extreme' && Math.random() < 0.5) return ObfuscationUtils.addZeroWidthSpaces(part);
          if (level === 'high' && Math.random() < 0.3) return ObfuscationUtils.addZeroWidthSpaces(part);
        }
        return part.trim();
      });

      let lineStr = '';
      for (let i = 0; i < formattedParts.length; i++) {
        if (i > 0) {
          let sep;
          if (isModernMode) {
              sep = ObfuscationUtils.getRandomSpacing();
              if (level === 'v4' && Math.random() < 0.3) sep += '.'; // Add random dot in V4
          } else {
              sep = Separators[Math.floor(Math.random() * Separators.length)];
          }
          lineStr += sep;
        }
        lineStr += formattedParts[i];
      }
      
      const result = lineStr;
      const endTime = Date.now();
      const generationTime = endTime - startTime;
      const variationCode = ObfuscationUtils.generateVariationCode();

      document.getElementById('resultDisplay').innerHTML = result;
      document.getElementById('generationTime').textContent = `${generationTime}ms`;
      document.getElementById('currentVariation').textContent = variationCode;

      stats.generateCount++;
      document.getElementById('generateCount').textContent = stats.generateCount;
      const obfuscationIcons = { v1:'‚ú®', v2:'‚ö°', v3:'üå™Ô∏è', v4:'‚ò†Ô∏è', low: 'üü¢', medium: 'üü°', high: 'üî¥', extreme: '‚ö´' };
      document.getElementById('obfuscationLevel').textContent = obfuscationIcons[level] || 'üîí';
      history.unshift({ result: result.replace(/<[^>]*>/g, ''), time: new Date().toLocaleTimeString('th-TH'), variation: variationCode });
      if (history.length > 5) history.pop();
      updateHistoryDisplay();
    }

    // 4. UI HANDLERS
    function updateHistoryDisplay() {
      const container = document.getElementById('historyContainer');
      if (history.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>';
        return;
      }
      container.innerHTML = history.map((item, index) => `
        <div class="bg-gray-800 p-3 rounded-lg text-sm">
          <div class="flex justify-between items-center mb-2">
            <span class="text-purple-400 font-mono">${item.variation}</span>
            <span class="text-gray-400">${item.time}</span>
          </div>
          <div class="text-gray-300 text-xs whitespace-pre-wrap">${item.result}</div>
        </div>
      `).join('');
    }

    function copyToClipboard() {
      const resultText = document.getElementById('resultDisplay').textContent;
      if (!resultText.trim()) { alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô'); return; }
      navigator.clipboard.writeText(resultText).then(() => {
        stats.copyCount++;
        document.getElementById('copyCount').textContent = stats.copyCount;
        if(typeof showToast === 'function') { showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!'); } else { alert('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß'); }
      }).catch(err => { alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ'); });
    }

    function clearResult() {
      document.getElementById('resultDisplay').innerHTML = '';
      document.getElementById('generationTime').textContent = '';
      document.getElementById('currentVariation').textContent = 'A1';
      document.getElementById('obfuscationLevel').textContent = 'üîí';
    }

    function generateNew() { generateRandomAddress();
    }
    
    const genBtn = document.getElementById('generateBtn');
    if(genBtn) genBtn.addEventListener('click', generateNew);
    const copyBtn = document.getElementById('copyBtn');
    if(copyBtn) copyBtn.addEventListener('click', copyToClipboard);
    const clearBtn = document.getElementById('clearBtn');
    if(clearBtn) clearBtn.addEventListener('click', clearResult);
    generateNew();
  })();
  </script>

  <script>
    (() => {
      const canvas = document.getElementById('matrixCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const matrix = "ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%+-/~{[|`]}";
      const matrixArray = matrix.split("");
      const fontSize = 10;
      const columns = canvas.width / fontSize;
      const drops = [];
      for (let x = 0; 
        x < columns; x++) { drops[x] = 1; }
      function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.04)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#0F3';
        ctx.font = fontSize + 'px monospace';
        for (let i = 0; i < drops.length; i++) {
          const text = matrixArray[Math.floor(Math.random() * matrixArray.length)];
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);
          if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) { drops[i] = 0;
          }
          drops[i]++;
        }
      }
      setInterval(draw, 35);
      window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
    })();
  </script>

  <script type="module">
    const SUPABASE_URL = "https://uromhoezcxkhilxchxxe.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVyb21ob2V6Y3hraGlseGNoeHhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMjEyOTUsImV4cCI6MjA2ODY5NzI5NX0.UDABYee8_JDlZHkKGzz6bQG0v95H86uLAP6WIN75Y7o";
    const SHARED_BOARD_ID = 'my-shared-board-123';
    const appId = SHARED_BOARD_ID;

    // --- CONSTANTS FOR EMAIL FEATURE ---
    const EMAIL_PREFIX = "vault://";
    const EMAIL_SEPARATOR = "|::|";

    let messagesChannel = null;
    let messageIdToDelete = null;
    let messageIdToEdit = null;
    let isEditingEmailMode = false;
    // Elements - Messages
    const messageForm = document.getElementById('message-form');
    const messageInput = document.getElementById('message-input');
    const titleInput = document.getElementById('title-input');
    const messagesContainer = document.getElementById('messages-container');
    
    // Elements - Emails
    const emailForm = document.getElementById('email-form');
    const emailTitleInput = document.getElementById('email-title-input');
    const emailAddrInput = document.getElementById('email-addr-input');
    const emailPassInput = document.getElementById('email-pass-input');
    const emailsContainer = document.getElementById('emails-container');
    // Quick Paste Element
    const quickPasteInput = document.getElementById('quick-paste-input');
    const btnPasteClipboard = document.getElementById('btn-paste-clipboard');

    const loadingState = document.getElementById('loading-state');
    const toast = document.getElementById('toast');
    const boardIdDisplay = document.getElementById('board-id-display');
    
    // Modals
    const confirmModal = document.getElementById('confirmModal');
    const modalCancelBtn = document.getElementById('modalCancelBtn');
    const modalConfirmBtn = document.getElementById('modalConfirmBtn');

    const editModal = document.getElementById('editModal');
    const editTitleInput = document.getElementById('editTitleInput');
    const editMessageInput = document.getElementById('editMessageInput');
    // New Edit Inputs for Email
    const editMessageContainer = document.getElementById('editMessageContainer');
    const editEmailContainer = document.getElementById('editEmailContainer');
    const editEmailField = document.getElementById('editEmailField');
    const editPasswordField = document.getElementById('editPasswordField');

    const editCancelBtn = document.getElementById('editCancelBtn');
    const editSaveBtn = document.getElementById('editSaveBtn');
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function main(){
      boardIdDisplay.textContent = appId;
      try{
        listenForMessages();
      }catch(error){ console.error("Error initializing Supabase:", error); loadingState.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå";
      }
    }

    function listenForMessages(){
      if (messagesChannel) { sb.removeChannel(messagesChannel);
      }
      loadAndRender();
      messagesChannel = sb.channel('links-realtime')
        .on('postgres_changes', { event: '*', schema: 'public', table: 'links' }, () => { loadAndRender(); })
        .subscribe();
    }

    async function loadAndRender(){
      loadingState.style.display = 'block';
      const { data, error } = await sb
        .from('links')
        .select('id, title, url, created_at, is_pinned')
        .order('created_at', { ascending: false });
      loadingState.style.display = 'none';

      if (error){ console.error("Error loading:", error); messagesContainer.innerHTML = `<p class="text-center text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</p>`; return;
      }

      // ‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Messages ‡πÅ‡∏•‡∏∞ Emails
      const allData = (data || []).map(row => ({
        id: row.id,
        title: row.title || '',
        rawUrl: row.url || '',
        isPinned: !!row.is_pinned,
        timestamp: { toDate: () => new Date(row.created_at) },
        created_at: row.created_at // Keep raw string for math
      }));
      const emails = [];
      const messages = [];

      allData.forEach(item => {
          if (item.rawUrl.startsWith(EMAIL_PREFIX)) {
              // Parse email data
              const content = item.rawUrl.replace(EMAIL_PREFIX, '');
              const parts = content.split(EMAIL_SEPARATOR);
              item.email = parts[0] || '';
              item.password = parts[1] || '';
              item.expiryDays = parseInt(parts[2]) || 1; // Default to 1 day if not set
              emails.push(item);
          } else {
              // Normal message
              item.text = item.rawUrl;
              messages.push(item);
          }
      });
      // Sort messages by pin
      messages.sort((a, b) => {
        if (a.isPinned && !b.isPinned) return -1;
        if (!a.isPinned && b.isPinned) return 1;
        return 0;
      });
      renderMessages(messages);
      renderEmails(emails);
    }

    // --- POSTING FUNCTIONS ---

    async function postMessage(text, title){
      if (!text.trim()) return;
      try{
        const { error } = await sb.from('links').insert([{ title: title||'', url: text, is_pinned: false }]);
        if (error) throw error;
        messageInput.value=''; titleInput.value='';
        showToast("‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
      }catch(error){ console.error("Error posting message:", error); alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°");
      }
    }

    async function postEmail(title, email, password, days) {
        if (!email.trim() || !password.trim()) return;
        
        // --- 1. Auto Generate Title as Date/Month if Empty ---
        let finalTitle = title.trim();
        if (!finalTitle) {
            const d = new Date();
            const day = d.getDate();
            const month = d.getMonth() + 1;
            finalTitle = `${day}/${month}`; // e.g., "2/2"
        }

        // --- 2. Combine into vault format with Expiry Days ---
        // Format: vault://email|::|password|::|days
        const secureString = `${EMAIL_PREFIX}${email}${EMAIL_SEPARATOR}${password}${EMAIL_SEPARATOR}${days}`;

        try {
            const { error } = await sb.from('links').insert([{ title: finalTitle, url: secureString, is_pinned: false }]);
            if (error) throw error;
            emailTitleInput.value = ''; emailAddrInput.value = ''; emailPassInput.value = '';
            showToast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        } catch(error) { console.error("Error posting email:", error); alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•"); }
    }

    // --- RENDER FUNCTIONS ---

    function renderMessages(messages){
      messagesContainer.innerHTML='';
      if (messages.length===0){ messagesContainer.innerHTML = `<p class="text-center text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</p>`; return; }
      messages.forEach(msg => { messagesContainer.appendChild(createMessageElement(msg)); });
    }

    function renderEmails(emails) {
        emailsContainer.innerHTML = '';
        if (emails.length === 0) { emailsContainer.innerHTML = `<p class="col-span-1 md:col-span-2 text-center text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ</p>`; return;
        }
        emails.forEach(mail => { emailsContainer.appendChild(createEmailCard(mail)); });
    }

    // --- CARD CREATION ---

    function createMessageElement(msg){
      const div = document.createElement('div');
      div.className = `p-5 rounded-xl flex flex-col gap-4 fade-in gradient-border transition-transform duration-300 hover:scale-[1.02] ${msg.isPinned ? 'pinned-message' : ''}`;
      let content = '';
      if (msg.title && msg.title.trim()){ content += `<div class="font-bold text-lg tracking-wide" style="color:#93c5fd">${escapeHTML(msg.title)}</div>`;
      }
      content += `<p class="text-cyan-100 whitespace-pre-wrap flex-1 text-base">${escapeHTML(msg.text)}</p>`;
      content += `<div class="flex items-center justify-between gap-4 w-full pt-2 border-t border-cyan-800/50">
        <span class="text-xs" style="color:#93c5fd">${msg.timestamp ?
        new Date(msg.timestamp.toDate()).toLocaleString('th-TH') : '...'}</span>
        <div class="flex flex-wrap items-center justify-end gap-2">
          ${msg.isPinned ?
          '<span class="text-yellow-400 text-lg">üìå</span>' : ''}
          <button class="pin-button btn btn-primary py-1 px-3 rounded-full text-sm">${msg.isPinned ?
          '‡πÄ‡∏•‡∏¥‡∏Å‡∏õ‡∏±‡∏Å' : '‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î'}</button>
          <button class="copy-button btn btn-primary py-1 px-3 rounded-full text-sm">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          <button class="edit-button btn btn-secondary py-1 px-3 rounded-full text-sm">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button class="delete-button btn btn-danger py-1 px-3 rounded-full text-sm">üóëÔ∏è ‡∏•‡∏ö</button>
        </div>
      </div>`;
      div.innerHTML = content;
      div.querySelector('.copy-button').onclick = (e) => { copyTextToClipboard(msg.text, e.target); };
      div.querySelector('.pin-button').onclick = () => { togglePinMessage(msg.id); };
      div.querySelector('.delete-button').onclick = () => { openDeleteModal(msg.id); };
      div.querySelector('.edit-button').onclick = () => { openEditModal(msg.id, msg.title, msg.text, false); };
      return div;
    }

    function createEmailCard(data) {
        const div = document.createElement('div');
        
        // --- 3. Expiry Calculation Logic ---
        const createdDate = new Date(data.created_at);
        const expiryMs = data.expiryDays * 24 * 60 * 60 * 1000;
        const expireDate = new Date(createdDate.getTime() + expiryMs);
        const now = new Date();
        const diffMs = expireDate - now;
        const diffHours = diffMs / (1000 * 60 * 60);

        let statusClass = '';
        let statusText = '';

        if (diffMs < 0) {
            statusClass = 'email-status-expired';
            statusText = '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß ‚ùå';
        } else if (diffHours <= 24) {
            statusClass = 'email-status-warning';
            statusText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ < 1 ‡∏ß‡∏±‡∏ô ‚ö†Ô∏è`;
        } else {
            statusClass = 'email-status-good';
            const daysLeft = Math.ceil(diffHours / 24);
            statusText = `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${daysLeft} ‡∏ß‡∏±‡∏ô ‚úÖ`;
        }

        // Apply classes
        div.className = `p-5 rounded-xl flex flex-col gap-3 gradient-border email-card transition-transform duration-300 hover:scale-[1.01] ${statusClass}`;
        
        div.innerHTML = `
            <div class="flex justify-between items-start mb-1">
                <div>
                    <div class="font-bold text-lg text-white">${escapeHTML(data.title)}</div>
                    <div class="text-xs text-gray-400 mt-1 font-mono">${statusText}</div>
                </div>
                <div class="flex gap-2">
                    <button class="edit-btn text-gray-400 hover:text-white transition">‚úèÔ∏è</button>
                    <button class="del-btn text-gray-400 hover:text-red-400 transition">üóëÔ∏è</button>
                </div>
            </div>
            
            <div class="email-field group relative">
                <span class="text-cyan-300 select-all truncate mr-2">${escapeHTML(data.email)}</span>
            </div>
          
            <div class="email-field group relative">
                <span class="password-mask password-dot">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</span>
                <span class="password-text hidden text-green-300 select-all font-mono">${escapeHTML(data.password)}</span>
                <button class="toggle-pass text-xs text-gray-400 hover:text-white ml-2 bg-gray-800 px-2 py-1 rounded">üëÅÔ∏è</button>
            </div>

            <div class="grid grid-cols-2 gap-3 mt-2">
                <button class="copy-email btn btn-primary py-2 text-sm">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏°‡∏•</button>
                <button class="copy-pass btn btn-secondary py-2 text-sm">üîë ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™</button>
            </div>
        `;
        // Handlers
        const passMask = div.querySelector('.password-mask');
        const passText = div.querySelector('.password-text');
        div.querySelector('.toggle-pass').onclick = (e) => {
            passMask.classList.toggle('hidden');
            passText.classList.toggle('hidden');
            e.target.textContent = passMask.classList.contains('hidden') ? 'üôà' : 'üëÅÔ∏è';
        };

        div.querySelector('.copy-email').onclick = (e) => copyTextToClipboard(data.email, e.target);
        div.querySelector('.copy-pass').onclick = (e) => copyTextToClipboard(data.password, e.target);
        div.querySelector('.del-btn').onclick = () => openDeleteModal(data.id);
        
        // Pass existing days to edit modal (to preserve it)
        div.querySelector('.edit-btn').onclick = () => openEditModal(data.id, data.title, null, true, data.email, data.password, data.expiryDays);

        return div;
    }

    // --- SHARED MODAL LOGIC ---

    function openDeleteModal(id) {
        messageIdToDelete = id;
        confirmModal.classList.remove('hidden');
    }
    function closeDeleteModal() {
        messageIdToDelete = null;
        confirmModal.classList.add('hidden');
    }
    modalCancelBtn.onclick = closeDeleteModal;
    modalConfirmBtn.onclick = async () => {
        if (messageIdToDelete) {
            const originalText = modalConfirmBtn.innerText;
            modalConfirmBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...";
            try {
                const { error } = await sb.from('links').delete().eq('id', messageIdToDelete);
                if (error) throw error;
                showToast("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            } catch (error) {
                console.error("Delete Error:", error);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö: " + error.message);
            } finally {
                modalConfirmBtn.innerText = originalText;
                closeDeleteModal();
            }
        }
    };
    // --- EDIT LOGIC (UPDATED FOR EMAIL) ---
    let editingEmailDays = 1; // Store original days when editing

    function openEditModal(id, currentTitle, currentText, isEmail = false, emailVal = '', passVal = '', currentDays = 1) {
        messageIdToEdit = id;
        isEditingEmailMode = isEmail;
        editTitleInput.value = currentTitle;

        if (isEmail) {
            // Show Email Inputs
            editMessageContainer.classList.add('hidden');
            editEmailContainer.classList.remove('hidden');
            editEmailField.value = emailVal;
            editPasswordField.value = passVal;
            editingEmailDays = currentDays; // Remember the original duration
        } else {
            // Show Message Textarea
            editMessageContainer.classList.remove('hidden');
            editEmailContainer.classList.add('hidden');
            editMessageInput.value = currentText;
        }
        editModal.classList.remove('hidden');
    }

    function closeEditModal() {
        messageIdToEdit = null;
        editModal.classList.add('hidden');
    }
    editCancelBtn.onclick = closeEditModal;

    editSaveBtn.onclick = async () => {
        if (!messageIdToEdit) return;
        const newTitle = editTitleInput.value;
        let newUrl = '';

        if (isEditingEmailMode) {
             const e = editEmailField.value.trim();
             const p = editPasswordField.value.trim();
             if (!e || !p) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö"); return;
             }
             // Preserve the original expiry days when editing
             newUrl = `${EMAIL_PREFIX}${e}${EMAIL_SEPARATOR}${p}${EMAIL_SEPARATOR}${editingEmailDays}`;
        } else {
             const t = editMessageInput.value;
             if (!t.trim()) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°"); return; }
             newUrl = t;
        }

        const originalText = editSaveBtn.innerText;
        editSaveBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
        try {
            const { error } = await sb.from('links').update({ title: newTitle, url: newUrl }).eq('id', messageIdToEdit);
            if (error) throw error;
            showToast("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            closeEditModal();
        } catch (error) {
            console.error("Edit Error:", error);
            alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
        } finally {
            editSaveBtn.innerText = originalText;
        }
    };

    // --- QUICK PASTE LISTENER ---
    if(quickPasteInput) {
        const handlePasteInput = (val) => {
             // Detect Email|Pass pattern
            if (val.includes('|')) {
                const parts = val.split('|');
                if(parts.length >= 2) {
                    const email = parts[0].trim();
                    const pass = parts[1].trim();
                    
                    if(email && pass) {
                        emailAddrInput.value = email;
                        emailPassInput.value = pass;
                        
                        // Auto-fill title with username part of email if empty (Optional override by Date later)
                        if(!emailTitleInput.value) {
                             emailTitleInput.value = email.split('@')[0];
                        }
                        
                        // Clear the paste area for clean feeling
                        quickPasteInput.value = '';
                        showToast("‡πÅ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Email/Pass ‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß!");
                        // Optional: Highlight the save button
                        document.querySelector('#email-form button[type="submit"]').focus();
                    }
                }
            }
        };
        quickPasteInput.addEventListener('input', (e) => handlePasteInput(e.target.value));
        
        // NEW: Paste Button Handler
        if(btnPasteClipboard) {
            btnPasteClipboard.addEventListener('click', async () => {
                try {
                    const text = await navigator.clipboard.readText();
                    if (!text) { showToast('Clipboard ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤'); return; 
                    }
                    quickPasteInput.value = text;
                    handlePasteInput(text); // Trigger logic manually
                } catch(err) {
                    console.error('Failed to read clipboard', err);
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Clipboard ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ Ctrl+V ‡πÅ‡∏ó‡∏ô');
                }
            });
        }
    }

    // --- UTILS ---

    function escapeHTML(str){ const p = document.createElement('p');
      p.textContent = str;
    return p.innerHTML; }
    
    // Forms Submit
    messageForm.addEventListener('submit', (e) => { e.preventDefault(); postMessage(messageInput.value, titleInput.value); });
    emailForm.addEventListener('submit', (e) => { 
        e.preventDefault(); 
        
        // Get Selected Day
        const selectedLife = document.querySelector('input[name="email-life"]:checked');
        const days = selectedLife ? selectedLife.value : 5; // Default 5

        postEmail(emailTitleInput.value, emailAddrInput.value, emailPassInput.value, days); 
    });
    async function togglePinMessage(messageId) {
      const { data, error } = await sb.from('links').select('is_pinned').eq('id', messageId).single();
      if (error){ console.error('togglePin read error:', error); return; }
      const currentPinnedStatus = !!data.is_pinned;
      const { error: upErr } = await sb.from('links').update({ is_pinned: !currentPinnedStatus }).eq('id', messageId);
      if (upErr){ console.error('togglePin update error:', upErr);
      }
    }

    function showToast(msg = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!'){ 
        toast.textContent = msg;
        toast.classList.remove('opacity-0','translate-y-10'); 
        toast.classList.add('opacity-100','translate-y-0'); 
        setTimeout(() => { 
            toast.classList.remove('opacity-100','translate-y-0'); 
            toast.classList.add('opacity-0','translate-y-10'); 
        }, 2000);
    }
    
    function copyTextToClipboard(text, button){ 
        navigator.clipboard.writeText(text).then(() => { 
            showToast(); 
            if (button && button.tagName === 'BUTTON'){ 
                const oldText = button.textContent;
                button.textContent = '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'; 
                setTimeout(() => { button.textContent = oldText; }, 2000); 
            } 
        }).catch(err => { console.error('Failed to copy text: ', err); });
    }

    main();
  </script>
</body>
</html>
