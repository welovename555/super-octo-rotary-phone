<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All-in-One Tools ‚Äî Reskin</title>
  
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg: #0b1220;
      --bg-2: #0f172a;
      --surface: #121a2b;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --primary: #60a5fa;
      --primary-strong: #3b82f6;
      --accent: #8b5cf6;
      --success: #22c55e;
      --danger: #ef4444;
      --card-border: rgba(148,163,184,.18);
      --soft-shadow: 0 10px 24px rgba(2,6,23,.35);
      --inner: inset 0 1px 0 rgba(255,255,255,.03);
      --radius: 16px;
    }

    body{
      font-family: 'Sarabun', system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px 600px at 10% -10%, #0f1a33 0%, transparent 60%),
        radial-gradient(800px 500px at 110% 10%, #101c3a 0%, transparent 55%),
        var(--bg);
      min-height: 100vh;
    }

    /* Nav Tabs */
    .tab-button{ color:#a3adc2; border:1px solid transparent; background: transparent; transition: all .2s ease; }
    .tab-button:hover{ color:#e5e7eb; background: rgba(255,255,255,.04); border-color: rgba(148,163,184,.2); }
    .tab-button.active-tab{ color:#0b1220; background: linear-gradient(135deg, var(--primary), var(--accent)); border-color: transparent; box-shadow: 0 8px 20px rgba(59,130,246,.30); }

    /* Cards */
    .panel{ background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)); border:1px solid var(--card-border); border-radius: var(--radius); box-shadow: var(--soft-shadow), var(--inner); }
    .stats-card{ background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid var(--card-border); border-radius: 12px; box-shadow: var(--inner); }

    /* Result */
    .result-box{ position: relative; overflow: hidden; background: var(--surface); border:1px solid var(--card-border); border-radius: var(--radius); box-shadow: var(--soft-shadow), var(--inner); }
    .result-box::before{ content:""; position:absolute; inset:0; background: linear-gradient(90deg, transparent, rgba(96,165,250,.09), transparent); transform: translateX(-100%); animation: shimmer 3.5s infinite; }
    @keyframes shimmer{ 0%{ transform: translateX(-100%) } 100%{ transform: translateX(100%) }}
    pre#resultDisplay{ font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color:#c7d2fe; line-height:1.7; }
    
    /* Highlight styles inside result */
    .house-highlight { background: rgba(59, 130, 246, 0.2); color: #93c5fd; padding: 0 4px; border-radius: 4px; }

    /* Buttons */
    .btn{ border:1px solid var(--card-border); border-radius: 12px; padding: 10px 16px; font-weight:700; transition: transform .05s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease; cursor: pointer; }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{ color:#0b1220; background: linear-gradient(135deg, var(--primary), var(--accent)); border-color: transparent; box-shadow: 0 10px 24px rgba(99,102,241,.25); }
    .btn-primary:hover{ filter: brightness(1.02); box-shadow: 0 14px 28px rgba(99,102,241,.3) }
    .btn-secondary{ color:#0b1220; background: linear-gradient(135deg, #34d399, #10b981); border-color: transparent; box-shadow: 0 10px 24px rgba(16,185,129,.22); }
    .btn-secondary:hover{ filter: brightness(1.03) }
    .btn-danger{ color:#fff; background: #dc2626; border-color: rgba(239,68,68,.6) }
    .btn-danger:hover{ background:#ef4444 }
    .btn-ghost{ color:#9ca3af; background: transparent; border-color: transparent; }
    .btn-ghost:hover{ color:#e5e7eb; background: rgba(255,255,255,0.05); }

    /* Toast & Modal */
    #toast{ background: linear-gradient(90deg, var(--primary), var(--accent)); box-shadow: 0 10px 30px rgba(59,130,246,.35); color:#0b1220; border-radius: 12px; }
    
    /* Custom Modal */
    .modal-backdrop { background-color: rgba(0, 0, 0, 0.6); backdrop-filter: blur(4px); }
    .modal-content { background: #16223a; border: 1px solid var(--card-border); box-shadow: 0 20px 50px rgba(0,0,0,0.5); animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    @keyframes modalPop { 0% { opacity: 0; transform: scale(0.9) translateY(10px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }

    /* Board message card */
    .gradient-border{ border-radius: 14px; border:1px solid var(--card-border); background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); box-shadow: var(--inner); }
    .pinned-message { border: 2px solid var(--primary); background: linear-gradient(180deg, rgba(96,165,250,.1), rgba(96,165,250,.05)); }

    /* Matrix BG */
    .matrix-bg{ position:fixed; inset:0; width:100vw; height:100vh; z-index:-1; opacity:.06; pointer-events:none; }

    /* Utility */
    .text-gray-400{ color: var(--muted) }
    .bg-gray-800{ background-color: #101a2c }
    .bg-gray-700{ background-color: #16223a }
    .bg-gray-900\/50{ background-color: rgba(2,6,23,.5) }
  </style>
</head>
<body class="text-gray-200">
  <canvas class="matrix-bg" id="matrixCanvas"></canvas>
  <div id="toast" class="fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-10 z-50 transition-all duration-300">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!</div>

  <div id="confirmModal" class="fixed inset-0 z-[100] flex items-center justify-center hidden modal-backdrop">
    <div class="modal-content rounded-2xl p-6 max-w-sm w-full mx-4 text-center">
      <div class="mb-4 text-red-400 text-5xl">‚ö†Ô∏è</div>
      <h3 class="text-xl font-bold text-white mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?</h3>
      <p class="text-gray-400 text-sm mb-6">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£‡πÅ‡∏•‡∏∞‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ<br>‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
      <div class="flex gap-3 justify-center">
        <button id="modalCancelBtn" class="btn btn-ghost w-1/2">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button id="modalConfirmBtn" class="btn btn-danger w-1/2 shadow-red-900/50 shadow-lg">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö</button>
      </div>
    </div>
  </div>

  <div class="container mx-auto max-w-6xl p-4 sm:p-6 lg:p-8">

    <nav class="flex justify-center items-center gap-2 md:gap-4 mb-8 bg-gray-900/50 p-2 rounded-xl backdrop-blur-sm panel">
      <button id="btn-address-tab" class="tab-button font-bold py-2 px-4 md:px-6 rounded-lg">üîê ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏±‡∏ö</button>
      <button id="btn-board-tab" class="tab-button font-bold py-2 px-4 md:px-6 rounded-lg">üí¨ ‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
    </nav>

    <main>
      <section id="address-tab">
        <div class="text-center mb-8">
          <h1 class="text-4xl md:text-6xl font-bold bg-clip-text text-transparent mb-4" style="background-image: linear-gradient(90deg, var(--primary), var(--accent));">üîê ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏±‡∏ö</h1>
          <p class="text-gray-400 text-lg mb-4">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß</p>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="stats-card p-4 text-center"><div class="text-2xl font-bold text-blue-400" id="generateCount">0</div><div class="text-xs text-gray-400">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</div></div>
          <div class="stats-card p-4 text-center"><div class="text-2xl font-bold text-green-400" id="copyCount">0</div><div class="text-xs text-gray-400">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</div></div>
          <div class="stats-card p-4 text-center"><div class="text-2xl font-bold text-purple-400" id="currentVariation">A1</div><div class="text-xs text-gray-400">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div></div>
          <div class="stats-card p-4 text-center"><div class="text-2xl font-bold text-yellow-400" id="obfuscationLevel">üîí</div><div class="text-xs text-gray-400">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏≤‡∏á</div></div>
        </div>

        <div class="result-box p-6 mb-6 relative">
          <div class="absolute top-4 right-4 text-xs text-gray-500" id="generationTime"></div>
          <pre id="resultDisplay" class="text-sm md:text-base leading-relaxed whitespace-pre-wrap min-h-[200px] overflow-x-auto"></pre>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
          <button id="generateBtn" class="btn btn-primary text-lg">üé≤ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</button>
          <button id="copyBtn" class="btn btn-secondary text-lg">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          <button id="clearBtn" class="btn btn-danger text-lg">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>

        <div class="panel rounded-xl p-6 mb-6">
          <h3 class="text-xl font-bold mb-4 text-center">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="addressSelect" class="block text-sm font-medium mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
              <select id="addressSelect" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"></select>
            </div>
            <div>
              <label for="obfuscationSelect" class="block text-sm font-medium mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß</label>
              <select id="obfuscationSelect" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"></select>
            </div>
          </div>
        </div>

        <div class="panel rounded-xl p-6">
          <h3 class="text-xl font-bold mb-4 text-center">üìö ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á (5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h3>
          <div id="historyContainer" class="space-y-2 max-h-60 overflow-y-auto">
            <div class="text-center text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
          </div>
        </div>
      </section>

      <section id="board-tab">
        <header class="text-center mb-8 py-8 rounded-2xl panel">
          <h1 class="text-3xl sm:text-4xl font-bold" style="background-image: linear-gradient(90deg, var(--primary), var(--accent)); -webkit-background-clip:text; background-clip:text; color: transparent;">‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</h1>
          <p class="text-gray-200 mt-2">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
          <div class="mt-4 text-sm" style="color:#93c5fd"><span>ID ‡∏ö‡∏≠‡∏£‡πå‡∏î: </span><span id="board-id-display" class="font-mono bg-gray-800 p-1 rounded shadow-inner"></span></div>
        </header>

        <div class="p-6 rounded-2xl shadow-2xl mb-8 gradient-border">
          <form id="message-form">
            <label for="title-input" class="block text-lg font-semibold mb-2" style="color:#93c5fd">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠/‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</label>
            <input id="title-input" type="text" class="w-full p-3 mb-3 bg-[#16223a] text-cyan-200 border border-cyan-700 focus:border-cyan-400 focus:ring-0 rounded-lg transition placeholder:text-cyan-700" placeholder="‡πÉ‡∏™‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå..." />
            <label for="message-input" class="block text-lg font-semibold mb-2" style="color:#93c5fd">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
            <textarea id="message-input" rows="4" class="w-full p-3 bg-[#16223a] text-cyan-100 border border-cyan-700 focus:border-cyan-400 focus:ring-0 rounded-lg transition placeholder:text-cyan-700" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
            <button type="submit" id="post-button" class="mt-4 w-full btn btn-primary">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
          </form>
        </div>

        <div id="messages-container" class="space-y-4">
          <div id="loading-state" class="text-center py-10"><p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...</p></div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // Tab Switching Logic
    document.addEventListener('DOMContentLoaded', () => {
      const tabs = document.querySelectorAll('main > section');
      const buttons = document.querySelectorAll('nav button');
      function switchTab(tabId) {
        tabs.forEach(tab => tab.classList.add('hidden'));
        const activeTab = document.getElementById(tabId);
        if (activeTab) activeTab.classList.remove('hidden');
        buttons.forEach(button => button.classList.remove('active-tab'));
        const activeButton = document.getElementById(`btn-${tabId}`);
        if (activeButton) activeButton.classList.add('active-tab');
      }
      buttons.forEach(button => button.addEventListener('click', () => switchTab(button.id.replace('btn-',''))));
      switchTab('address-tab');
    });
  </script>

  <script>
  (() => {
    const ADDRESSES = {
      home: { houseNumber: "82/7", soi: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á16", village: "‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£2", road: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", subdistrict: "‡∏£‡∏≤‡∏ä‡∏≤‡πÄ‡∏ó‡∏ß‡∏∞", district: "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ", province: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", postalCode: "10540" },
      alt1: { houseNumber: "22/4", soi: "‡πÉ‡∏à‡πÄ‡∏≠‡∏∑‡πâ‡∏≠ 2", village: "", road: "", subdistrict: "‡∏ö‡∏≤‡∏á‡∏Ç‡∏∞‡πÅ‡∏¢‡∏á", district: "", province: "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", postalCode: "12000" }
    };
    const PHONES = { home: "0951698770", alt1: "0946401569" };
 
    let CURRENT_ADDRESS_KEY = 'home';

    document.getElementById('addressSelect').innerHTML = '<option value="home">‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£</option><option value="alt1">‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏ó‡∏∏‡∏°</option>';
    
    // UPDATED: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å V.1 ‡πÅ‡∏•‡∏∞ V.2
    document.getElementById('obfuscationSelect').innerHTML = 
    '<option value="v1">‚ú® ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà V.1 (‡πÄ‡∏ô‡πâ‡∏ô‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢/‡∏ß‡∏£‡∏£‡∏Ñ)</option>' +
    '<option value="v2">‚ö° ‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà V.2 (‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á/‡∏ß‡∏£‡∏£‡∏Ñ)</option>' +
    '<option value="low">üü¢ ‡∏ï‡πà‡∏≥ - ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</option>' +
    '<option value="medium" selected>üü° ‡∏Å‡∏•‡∏≤‡∏á - ‡∏™‡∏°‡∏î‡∏∏‡∏•</option>' +
    '<option value="high">üî¥ ‡∏™‡∏π‡∏á - ‡∏û‡∏£‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏Å</option>' +
    '<option value="extreme">‚ö´ ‡∏™‡∏∏‡∏î‡∏Ç‡∏±‡πâ‡∏ô - ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å</option>';

    document.getElementById('addressSelect').addEventListener('change', (e) => { CURRENT_ADDRESS_KEY = e.target.value; generateNew(); });

    let stats = { generateCount: 0, copyCount: 0 };
    let history = [];
    
    const Labels = {
      house: ['‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô', 'House No.', 'Address No.', 'Addr. No.', 'Unit', '#', ''],
      phone: ['‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', '‡πÇ‡∏ó‡∏£', '‡πÄ‡∏ö‡∏≠‡∏£‡πå', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£', 'Tel', 'Tel.', 'Mobile', 'Contact', 'Contact No.', ''],
      soi: ['‡∏ã‡∏≠‡∏¢', '‡∏ã.', 'Soi', ''],
      village: ['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô', '‡∏°.', '‡∏´‡∏°‡∏π‡πà', ''],
      road: ['‡∏ñ‡∏ô‡∏ô', '‡∏ñ.', 'Rd.', ''],
      subdistrict: ['‡∏ï‡∏≥‡∏ö‡∏•', '‡∏ï.', ''],
      district: ['‡∏≠‡∏≥‡πÄ‡∏†‡∏≠', '‡∏≠.', ''],
      province: ['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '‡∏à.', ''],
      postal: ['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±‡∏™', 'Zip', '']
    };
    
    const FuzzyLabels = {
      house: ['‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡πÖ‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏ã‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤‡∏ô‡πÄx‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤u‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πÖ‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡πÖ‡∏ô‡πÄ‡∏•x‡∏ó‡∏µ‡πà', '‡∏ö‡∏≤u‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', 'l‡∏ö‡πÖ‡∏ô‡πÄ‡∏•‡∏Ç', 'H0use No.', 'H‡πêuse', 'Addr. No.', 'L‡∏ö‡πâ‡∏≤‡∏ô'],
      phone: ['‡πÇ‡∏ós‡∏±‡∏û‡∏ó‡πå', '‡πÇ‡∏ó‡∏£s‡∏±s‡∏ó‡πå', '‡πÇ‡∏óp‡∏®‡∏±‡∏û', '‡πÇ‡∏ó‡∏£s‡∏±‡∏ö', '‡πÄbo‡∏£‡πå', 'l‡πÄ‡∏öo‡∏£‡πå', '‡πÄb‡∏≠‡∏£‡πå', '‡πÇ‡∏ós', 'T‚ÑÆl', 'Mob1le', 'C0ntact', 'Tel.'],
      soi: ['‡∏ão‡∏¢', '‡∏ãx‡∏¢', '‡∏ã0‡∏¢'],
      village: ['‡∏´‡∏°‡∏π‡πà‡∏ö‡∏≤u', '‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤u', '‡∏´‡∏°‡∏πv‡∏ö‡∏≤u'],
      road: ['‡∏ñu‡∏ô', '‡∏ñuv', '‡∏ñv‡∏ô'],
      subdistrict: ['‡∏ï‡∏≥‡∏öu', '‡∏ï‡πç‡∏≤‡∏ö‡∏•', '‡∏ïx‡∏ö‡∏•'],
      district: ['‡∏≠‡∏≥p‡∏≠', '‡∏≠‡∏≥‡πÄ‡πÖ‡∏≠', '‡∏≠‡πç‡∏≤‡πÄ‡∏†o'],
      province: ['‡∏à‡∏±‡∏á‡∏´‡∏ß‡πâ‡∏î', '‡∏à‡∏±n‡∏´‡∏ß‡∏±‡∏î', '‡∏à‡∏±J‡∏´‡∏ß‡∏±‡∏î'],
      postal: ['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õs‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±n‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±‡∏™‡πÑp‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå']
    };
    const Separators = [', ', ' ', '  ', '   ', '. ', ' - '];
    
    const ObfuscationUtils = {
      Punctuation: ['.', ',', '/', '-', '_'],
      toThaiNumerals: (str) => str.replace(/[0-9]/g, (d) => '‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô'[d]),
      addZeroWidthSpaces: (str) => str.split('').join('\u200B'),
      injectPunctuation: (str) => {
        const level = document.getElementById('obfuscationSelect').value;
        const chance = { low: 0, medium: 0.05, high: 0.15, extreme: 0.3 }[level] || 0;
        if (chance === 0 || !str) return str;
        let result = '';
        for (const char of str) {
          result += char;
          if (Math.random() < chance && char !== ' ' && !ObfuscationUtils.Punctuation.includes(char)) {
            result += ObfuscationUtils.Punctuation[Math.floor(Math.random() * ObfuscationUtils.Punctuation.length)];
          }
        }
        return result;
      },
      formatNumber: (num) => {
        if (!num) return '';
        const formats = [num, num.replace('/', ' / '), num.replace('/', '-'), `No.${num}`, num.split('').join(' ')];
        return formats[Math.floor(Math.random() * formats.length)];
      },
      formatPhone: (phone) => {
        if (!phone) return '';
        const formats = [phone, phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3'), phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1 $2 $3'), '+66 ' + phone.slice(1)];
        return formats[Math.floor(Math.random() * formats.length)];
      },
      generateVariationCode: () => 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[Math.floor(Math.random() * 26)] + '0123456789'[Math.floor(Math.random() * 10)]
    };

    function generateRandomAddress() {
      const startTime = Date.now();
      const level = document.getElementById('obfuscationSelect').value;
      const selectedAddress = ADDRESSES[CURRENT_ADDRESS_KEY];
      const selectedPhone = PHONES[CURRENT_ADDRESS_KEY];
      
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î V1 ‡∏´‡∏£‡∏∑‡∏≠ V2 ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      const isNewMode = (level === 'v1' || level === 'v2');

      const postal = (!isNewMode && Math.random() < 0.5) ? ObfuscationUtils.toThaiNumerals(selectedAddress.postalCode) : selectedAddress.postalCode;

      const allComponents = [
        { type:'house', value: isNewMode ? selectedAddress.houseNumber : `<mark class="house-highlight">${ObfuscationUtils.formatNumber(selectedAddress.houseNumber)}</mark>`, labelPool: Labels.house, required: !!selectedAddress.houseNumber },
        { type:'phone', value: ObfuscationUtils.formatPhone(selectedPhone), labelPool: Labels.phone, required: !!selectedPhone },
        { type:'soi', value: selectedAddress.soi, labelPool: Labels.soi },
        { type:'village', value: selectedAddress.village, labelPool: Labels.village },
        { type:'road', value: selectedAddress.road, labelPool: Labels.road },
        { type:'subdistrict', value: selectedAddress.subdistrict, labelPool: Labels.subdistrict },
        { type:'district', value: selectedAddress.district, labelPool: Labels.district },
        { type:'province', value: selectedAddress.province, labelPool: Labels.province },
        { type:'postal', value: postal, labelPool: Labels.postal }
      ].filter(c => c.value && String(c.value).replace(/<[^>]*>/g, '').trim() !== '');

      let componentsToUse;
      
      if (isNewMode) {
          // --- LOGIC ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö V.1 ‡πÅ‡∏•‡∏∞ V.2 ---
          // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏•‡∏≥‡∏î‡∏±‡∏ö: ‡∏ö‡πâ‡∏≤‡∏ô -> ‡πÄ‡∏ö‡∏≠‡∏£‡πå -> (‡∏≠‡∏∑‡πà‡∏ô‡πÜ) -> ‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå
          const house = allComponents.find(c => c.type === 'house');
          const phone = allComponents.find(c => c.type === 'phone');
          const postal = allComponents.find(c => c.type === 'postal');
          
          let others = allComponents.filter(c => c.type !== 'house' && c.type !== 'phone' && c.type !== 'postal');

          if (level === 'v2') {
              // V.2: ‡∏™‡∏•‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á
              others = others.sort(() => 0.5 - Math.random());
          }
          // V.1: ‡πÑ‡∏°‡πà‡∏™‡∏•‡∏±‡∏ö (others ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° Array ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‡∏Ñ‡∏∑‡∏≠ ‡∏ã‡∏≠‡∏¢ -> ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô -> ‡∏ñ‡∏ô‡∏ô...)

          componentsToUse = [];
          if(house) componentsToUse.push(house);
          if(phone) componentsToUse.push(phone);
          componentsToUse = componentsToUse.concat(others);
          if(postal) componentsToUse.push(postal); // ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå‡∏≠‡∏¢‡∏π‡πà‡∏ó‡πâ‡∏≤‡∏¢‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠

      } else {
          // --- LOGIC ‡πÄ‡∏î‡∏¥‡∏° (Low-Extreme) ---
          const required = allComponents.filter(c => c.required);
          const optional = allComponents.filter(c => !c.required);
          const numOptionalToUse = Math.floor(Math.random() * (optional.length - 2)) + 3;
          componentsToUse = [...required, ...optional.sort(() => 0.5 - Math.random()).slice(0, numOptionalToUse)].sort(() => 0.5 - Math.random());
      }

      const formattedParts = componentsToUse.map(comp => {
        let labelPool = comp.labelPool;
        let label = labelPool[Math.floor(Math.random() * labelPool.length)];
        
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà V1/V2 ‡πÉ‡∏´‡πâ‡∏™‡∏∏‡πà‡∏°‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡πÉ‡∏ä‡πâ FuzzyLabels (‡∏†‡∏≤‡∏©‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏î‡∏≤‡∏ß)
        if (!isNewMode && Math.random() < 0.4 && FuzzyLabels[comp.type]?.length > 0) {
          label = FuzzyLabels[comp.type][Math.floor(Math.random() * FuzzyLabels[comp.type].length)];
        }

        const showLabel = label && (comp.required || Math.random() > 0.3);
        
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô V1/V2 ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏à‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏´‡∏•‡∏≤‡∏î (injectPunctuation)
        const value = (comp.type === 'house' || isNewMode) ? comp.value : ObfuscationUtils.injectPunctuation(comp.value);
        
        let part = showLabel ? `${label} ${value}` : value;

        if (comp.type !== 'house' && !isNewMode){
          if (level === 'extreme' && Math.random() < 0.5) return ObfuscationUtils.addZeroWidthSpaces(part);
          if (level === 'high' && Math.random() < 0.3) return ObfuscationUtils.addZeroWidthSpaces(part);
        }
        return part.trim();
      });

      let lineStr = '';
      for (let i = 0; i < formattedParts.length; i++) {
        if (i > 0) {
          // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô V.1/V.2 ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡∏¢‡∏≤‡∏ß‡πÜ (4 ‡πÄ‡∏Ñ‡∏≤‡∏∞) ‡πÅ‡∏ó‡∏ô comma
          const sep = isNewMode ? '    ' : Separators[Math.floor(Math.random() * Separators.length)];
          lineStr += sep; 
        }
        lineStr += formattedParts[i];
      }
      const result = lineStr;

      const endTime = Date.now();
      const generationTime = endTime - startTime;
      const variationCode = ObfuscationUtils.generateVariationCode();

      document.getElementById('resultDisplay').innerHTML = result;
      document.getElementById('generationTime').textContent = `${generationTime}ms`;
      document.getElementById('currentVariation').textContent = variationCode;

      stats.generateCount++;
      document.getElementById('generateCount').textContent = stats.generateCount;
      const obfuscationIcons = { v1:'‚ú®', v2:'‚ö°', low: 'üü¢', medium: 'üü°', high: 'üî¥', extreme: '‚ö´' };
      document.getElementById('obfuscationLevel').textContent = obfuscationIcons[level] || 'üîí';
      
      history.unshift({ result: result.replace(/<[^>]*>/g, ''), time: new Date().toLocaleTimeString('th-TH'), variation: variationCode });
      if (history.length > 5) history.pop();
      updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
      const container = document.getElementById('historyContainer');
      if (history.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>';
        return;
      }
      container.innerHTML = history.map((item, index) => `
        <div class="bg-gray-800 p-3 rounded-lg text-sm">
          <div class="flex justify-between items-center mb-2">
            <span class="text-purple-400 font-mono">${item.variation}</span>
            <span class="text-gray-400">${item.time}</span>
          </div>
          <div class="text-gray-300 text-xs whitespace-pre-wrap">${item.result}</div>
        </div>
      `).join('');
    }

    function copyToClipboard() {
      const resultText = document.getElementById('resultDisplay').textContent;
      if (!resultText.trim()) {
        alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      navigator.clipboard.writeText(resultText).then(() => {
        stats.copyCount++;
        document.getElementById('copyCount').textContent = stats.copyCount;
        showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!');
      }).catch(err => {
        console.error('Failed to copy: ', err);
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ');
      });
    }

    function clearResult() {
      document.getElementById('resultDisplay').innerHTML = '';
      document.getElementById('generationTime').textContent = '';
      document.getElementById('currentVariation').textContent = 'A1';
      document.getElementById('obfuscationLevel').textContent = 'üîí';
    }

    function generateNew() { generateRandomAddress(); }
    
    document.getElementById('generateBtn').addEventListener('click', generateNew);
    document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
    document.getElementById('clearBtn').addEventListener('click', clearResult);

    generateNew();
  })();
  </script>

  <script>
    (() => {
      const canvas = document.getElementById('matrixCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const matrix = "ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%+-/~{[|`]}";
      const matrixArray = matrix.split("");
      const fontSize = 10;
      const columns = canvas.width / fontSize;
      const drops = [];
      for (let x = 0; x < columns; x++) { drops[x] = 1; }
      function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.04)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#0F3';
        ctx.font = fontSize + 'px monospace';
        for (let i = 0; i < drops.length; i++) {
          const text = matrixArray[Math.floor(Math.random() * matrixArray.length)];
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);
          if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) { drops[i] = 0; }
          drops[i]++;
        }
      }
      setInterval(draw, 35);
      window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
    })();
  </script>

  <script type="module">
    const SUPABASE_URL = "https://uromhoezcxkhilxchxxe.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVyb21ob2V6Y3hraGlseGNoeHhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMjEyOTUsImV4cCI6MjA2ODY5NzI5NX0.UDABYee8_JDlZHkKGzz6bQG0v95H86uLAP6WIN75Y7o";

    const SHARED_BOARD_ID = 'my-shared-board-123';
    const appId = SHARED_BOARD_ID;

    let currentUserId = 'anon';
    let messagesChannel = null;
    let messageIdToDelete = null;

    const messageForm = document.getElementById('message-form');
    const messageInput = document.getElementById('message-input');
    const titleInput = document.getElementById('title-input');
    const messagesContainer = document.getElementById('messages-container');
    const loadingState = document.getElementById('loading-state');
    const toast = document.getElementById('toast');
    const boardIdDisplay = document.getElementById('board-id-display');
    const confirmModal = document.getElementById('confirmModal');
    const modalCancelBtn = document.getElementById('modalCancelBtn');
    const modalConfirmBtn = document.getElementById('modalConfirmBtn');
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function main(){
      boardIdDisplay.textContent = appId;
      try{
        listenForMessages();
      }catch(error){ console.error("Error initializing Supabase:", error); loadingState.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå"; }
    }

    function listenForMessages(){
      if (messagesChannel) { sb.removeChannel(messagesChannel); }
      loadAndRender();
      messagesChannel = sb.channel('links-realtime')
        .on('postgres_changes', { event: '*', schema: 'public', table: 'links' }, () => { loadAndRender(); })
        .subscribe();
    }

    async function loadAndRender(){
      loadingState.style.display = 'none';
      const { data, error } = await sb
        .from('links')
        .select('id, title, url, created_at, is_pinned')
        .order('created_at', { ascending: false });
      if (error){ console.error("Error loading:", error); messagesContainer.innerHTML = `<p class="text-center text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ</p>`; return; }

      const messages = (data || []).map(row => ({
        id: row.id,
        title: row.title || '',
        text: row.url || '',
        isPinned: !!row.is_pinned,
        timestamp: { toDate: () => new Date(row.created_at) }
      }));
      messages.sort((a, b) => {
        if (a.isPinned && !b.isPinned) return -1;
        if (!a.isPinned && b.isPinned) return 1;
        return 0;
      });
      renderMessages(messages);
    }

    async function postMessage(text, title){
      if (!text.trim()) return;
      try{
        const { error } = await sb.from('links').insert([{ title: title||'', url: text, is_pinned: false }]);
        if (error) throw error;
        messageInput.value=''; titleInput.value='';
      }catch(error){ console.error("Error posting message:", error); alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°"); }
    }

    function openDeleteModal(id) {
        messageIdToDelete = id;
        confirmModal.classList.remove('hidden');
    }

    function closeDeleteModal() {
        messageIdToDelete = null;
        confirmModal.classList.add('hidden');
    }

    modalCancelBtn.onclick = closeDeleteModal;

    modalConfirmBtn.onclick = async () => {
        if (messageIdToDelete) {
            const originalText = modalConfirmBtn.innerText;
            modalConfirmBtn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...";
            
            try {
                const { error } = await sb.from('links').delete().eq('id', messageIdToDelete);
                if (error) throw error;
                
                showToast("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
                closeDeleteModal();
            } catch (error) {
                console.error("Delete Error:", error);
                if(error.code === "42501" || error.message.includes("policy")) {
                   alert("‚ùå ‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase Policy ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏ö (DELETE) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö anon");
                } else {
                   alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö: " + error.message);
                }
            } finally {
                modalConfirmBtn.innerText = originalText;
                closeDeleteModal();
            }
        }
    };
    function renderMessages(messages){
      messagesContainer.innerHTML='';
      if (messages.length===0){ messagesContainer.innerHTML = `<p class="text-center text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏•‡∏≠‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏™‡∏¥!</p>`; return; }
      messages.forEach(msg => { const messageElement = createMessageElement(msg); messagesContainer.appendChild(messageElement); });
    }

    function createMessageElement(msg){
      const div = document.createElement('div');
      div.className = `p-5 rounded-xl flex flex-col gap-4 fade-in gradient-border transition-transform duration-300 hover:scale-[1.02] ${msg.isPinned ? 'pinned-message' : ''}`;
      let content = '';
      if (msg.title && msg.title.trim()){ content += `<div class="font-bold text-lg tracking-wide" style="color:#93c5fd">${escapeHTML(msg.title)}</div>`; }
      content += `<p class="text-cyan-100 whitespace-pre-wrap flex-1 text-base">${escapeHTML(msg.text)}</p>`;
      content += `<div class="flex items-center justify-between gap-4 w-full pt-2 border-t border-cyan-800/50">
        <span class="text-xs" style="color:#93c5fd">${msg.timestamp ? new Date(msg.timestamp.toDate()).toLocaleString('th-TH') : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...'}</span>
        <div class="flex items-center gap-2">
          ${msg.isPinned ? '<span class="text-yellow-400 text-lg">üìå</span>' : ''}
          <button class="pin-button btn btn-primary py-1 px-3 rounded-full text-sm">${msg.isPinned ? '‡πÄ‡∏•‡∏¥‡∏Å‡∏õ‡∏±‡∏Å' : '‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î'}</button>
          <button class="copy-button btn btn-primary py-1 px-3 rounded-full text-sm">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          <button class="delete-button btn btn-danger py-1 px-3 rounded-full text-sm">üóëÔ∏è ‡∏•‡∏ö</button>
        </div>
      </div>`;
      div.innerHTML = content;
      div.querySelector('.copy-button').onclick = (e) => { copyTextToClipboard(msg.text, e.target); };
      div.querySelector('.pin-button').onclick = () => { togglePinMessage(msg.id); };
      div.querySelector('.delete-button').onclick = () => { openDeleteModal(msg.id); };
      return div;
    }

    function escapeHTML(str){ const p = document.createElement('p'); p.textContent = str; return p.innerHTML; }
    messageForm.addEventListener('submit', (e) => { e.preventDefault(); postMessage(messageInput.value, titleInput.value); });
    async function togglePinMessage(messageId) {
      const { data, error } = await sb.from('links').select('is_pinned').eq('id', messageId).single();
      if (error){ console.error('togglePin read error:', error); return; }
      const currentPinnedStatus = !!data.is_pinned;
      const { error: upErr } = await sb.from('links').update({ is_pinned: !currentPinnedStatus }).eq('id', messageId);
      if (upErr){ console.error('togglePin update error:', upErr); }
    }

    function showToast(msg = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!'){ 
        toast.textContent = msg;
        toast.classList.remove('opacity-0','translate-y-10'); 
        toast.classList.add('opacity-100','translate-y-0'); 
        setTimeout(() => { 
            toast.classList.remove('opacity-100','translate-y-0'); 
            toast.classList.add('opacity-0','translate-y-10'); 
        }, 2000);
    }
    function copyTextToClipboard(text, button){ navigator.clipboard.writeText(text).then(() => { showToast(); if (button){ button.textContent = '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'; setTimeout(() => { button.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å'; }, 2000); } }).catch(err => { console.error('Failed to copy text: ', err); }); }

    main();
  </script>
</body>
</html>
