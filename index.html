<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All-in-One Tools ‚Äî Reskin</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Supabase JS (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô Supabase ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- Reskin Styles: ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤ (‡πÑ‡∏°‡πà‡πÅ‡∏ï‡∏∞‡∏£‡∏∞‡∏ö‡∏ö/‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á/ID/JS) -->
  <style>
    :root{
      --bg: #0b1220;          /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏´‡∏•‡∏±‡∏Å (‡∏î‡∏≤‡∏£‡πå‡∏Å‡∏™‡∏∏‡∏†‡∏≤‡∏û) */
      --bg-2: #0f172a;        /* ‡∏ä‡∏±‡πâ‡∏ô‡∏ú‡∏¥‡∏ß‡∏Å‡∏≤‡∏£‡πå‡∏î */
      --surface: #121a2b;     /* ‡∏û‡∏∑‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πà‡∏≠‡∏á/‡∏Å‡∏≤‡∏£‡πå‡∏î */
      --text: #e5e7eb;        /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏•‡∏±‡∏Å */
      --muted: #9ca3af;       /* ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏£‡∏≠‡∏á */
      --primary: #60a5fa;     /* ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
      --primary-strong: #3b82f6; /* ‡∏ü‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏° */
      --accent: #8b5cf6;      /* ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô */
      --success: #22c55e;     /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
      --danger: #ef4444;      /* ‡πÅ‡∏î‡∏á */
      --card-border: rgba(148,163,184,.18);
      --soft-shadow: 0 10px 24px rgba(2,6,23,.35);
      --inner: inset 0 1px 0 rgba(255,255,255,.03);
      --radius: 16px;
    }

    body{
      font-family: 'Sarabun', system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans Thai", sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px 600px at 10% -10%, #0f1a33 0%, transparent 60%),
        radial-gradient(800px 500px at 110% 10%, #101c3a 0%, transparent 55%),
        var(--bg);
      min-height: 100vh;
    }

    /* Nav Tabs */
    .tab-button{ color:#a3adc2; border:1px solid transparent; background: transparent; transition: all .2s ease; }
    .tab-button:hover{ color:#e5e7eb; background: rgba(255,255,255,.04); border-color: rgba(148,163,184,.2); }
    .tab-button.active-tab{ color:#0b1220; background: linear-gradient(135deg, var(--primary), var(--accent)); border-color: transparent; box-shadow: 0 8px 20px rgba(59,130,246,.30); }

    /* Cards */
    .panel{ background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)); border:1px solid var(--card-border); border-radius: var(--radius); box-shadow: var(--soft-shadow), var(--inner); }

    /* Metric cards */
    .stats-card{ background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); border:1px solid var(--card-border); border-radius: 12px; box-shadow: var(--inner); }

    /* Result */
    .result-box{ position: relative; overflow: hidden; background: var(--surface); border:1px solid var(--card-border); border-radius: var(--radius); box-shadow: var(--soft-shadow), var(--inner); }
    .result-box::before{ content:""; position:absolute; inset:0; background: linear-gradient(90deg, transparent, rgba(96,165,250,.09), transparent); transform: translateX(-100%); animation: shimmer 3.5s infinite; }
    @keyframes shimmer{ 0%{ transform: translateX(-100%) } 100%{ transform: translateX(100%) }}
    pre#resultDisplay{ font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; color:#c7d2fe; line-height:1.7; }

    /* Buttons */
    .btn{ border:1px solid var(--card-border); border-radius: 12px; padding: 10px 16px; font-weight:700; transition: transform .05s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease; }
    .btn:active{ transform: translateY(1px); }
    .btn-primary{ color:#0b1220; background: linear-gradient(135deg, var(--primary), var(--accent)); border-color: transparent; box-shadow: 0 10px 24px rgba(99,102,241,.25); }
    .btn-primary:hover{ filter: brightness(1.02); box-shadow: 0 14px 28px rgba(99,102,241,.3) }
    .btn-secondary{ color:#0b1220; background: linear-gradient(135deg, #34d399, #10b981); border-color: transparent; box-shadow: 0 10px 24px rgba(16,185,129,.22); }
    .btn-secondary:hover{ filter: brightness(1.03) }
    .btn-danger{ color:#fff; background: #dc2626; border-color: rgba(239,68,68,.6) }
    .btn-danger:hover{ background:#ef4444 }

    /* Toast */
    #toast{ background: linear-gradient(90deg, var(--primary), var(--accent)); box-shadow: 0 10px 30px rgba(59,130,246,.35); color:#0b1220; border-radius: 12px; }

    /* Board message card */
    .gradient-border{ border-radius: 14px; border:1px solid var(--card-border); background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01)); box-shadow: var(--inner); }
    .pinned-message { border: 2px solid var(--primary); background: linear-gradient(180deg, rgba(96,165,250,.1), rgba(96,165,250,.05)); }

    /* Matrix BG (‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏∏‡∏†‡∏≤‡∏û‡∏•‡∏á) */
    .matrix-bg{ position:fixed; inset:0; width:100vw; height:100vh; z-index:-1; opacity:.06; pointer-events:none; }

    /* Misc */
    .hi-tech-glow{ text-shadow: none; }
    .pulse-glow{ animation: none; }

    /* Override some Tailwind colors for calmer look */
    .text-gray-400{ color: var(--muted) }
    .text-gray-500{ color: #94a3b8 }
    .bg-gray-800{ background-color: #101a2c }
    .bg-gray-700{ background-color: #16223a }
    .bg-gray-900\/50{ background-color: rgba(2,6,23,.5) }
  </style>
</head>
<body class="text-gray-200">
  <!-- Global Elements -->
  <canvas class="matrix-bg" id="matrixCanvas"></canvas>
  <div id="toast" class="fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-10 z-50">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!</div>

  <!-- Main Container (ID/‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î) -->
  <div class="container mx-auto max-w-6xl p-4 sm:p-6 lg:p-8">

    <!-- Navigation Bar (‡πÄ‡∏î‡∏¥‡∏°) -->
    <nav class="flex justify-center items-center gap-2 md:gap-4 mb-8 bg-gray-900/50 p-2 rounded-xl backdrop-blur-sm panel">
      <button id="btn-address-tab" class="tab-button font-bold py-2 px-4 md:px-6 rounded-lg">üîê ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏±‡∏ö</button>
      <button id="btn-board-tab" class="tab-button font-bold py-2 px-4 md:px-6 rounded-lg">üí¨ ‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
    </nav>

    <main>
      <!-- Tab 1: Address Generator (IDs/‡∏Ñ‡∏•‡∏≤‡∏™‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°) -->
      <section id="address-tab">
        <div class="text-center mb-8">
          <h1 class="text-4xl md:text-6xl font-bold bg-clip-text text-transparent mb-4" style="background-image: linear-gradient(90deg, var(--primary), var(--accent));">üîê ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏±‡∏ö</h1>
          <p class="text-gray-400 text-lg mb-4">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß</p>
          <div class="flex flex-wrap justify-center gap-3 text-sm">
            <span class="px-3 py-1 rounded-full" style="background: rgba(96,165,250,.12); color:#93c5fd">üé≤ ‡∏™‡∏∏‡πà‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö 1000+ ‡πÅ‡∏ö‡∏ö</span>
            <span class="px-3 py-1 rounded-full" style="background: rgba(16,185,129,.12); color:#86efac">üõ°Ô∏è ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ö‡∏≠‡∏ó AI</span>
            <span class="px-3 py-1 rounded-full" style="background: rgba(139,92,246,.12); color:#c4b5fd">‚ö° Real‚Äëtime</span>
          </div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          <div class="stats-card p-4 text-center"><div class="text-2xl font-bold text-blue-400" id="generateCount">0</div><div class="text-xs text-gray-400">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á</div></div>
          <div class="stats-card p-4 text-center"><div class="text-2xl font-bold text-green-400" id="copyCount">0</div><div class="text-xs text-gray-400">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</div></div>
          <div class="stats-card p-4 text-center"><div class="text-2xl font-bold text-purple-400" id="currentVariation">A1</div><div class="text-xs text-gray-400">‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</div></div>
          <div class="stats-card p-4 text-center"><div class="text-2xl font-bold text-yellow-400" id="obfuscationLevel">üîí</div><div class="text-xs text-gray-400">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏≤‡∏á</div></div>
        </div>

        <div class="result-box p-6 mb-6 relative">
          <div class="absolute top-4 right-4 text-xs text-gray-500" id="generationTime"></div>
          <pre id="resultDisplay" class="text-sm md:text-base leading-relaxed whitespace-pre-wrap min-h-[200px] overflow-x-auto"></pre>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
          <button id="generateBtn" class="btn btn-primary text-lg">üé≤ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</button>
          <button id="copyBtn" class="btn btn-secondary text-lg">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
          <button id="clearBtn" class="btn btn-danger text-lg">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>

        <div class="panel rounded-xl p-6 mb-6">
          <h3 class="text-xl font-bold mb-4 text-center">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</h3>
          <!-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å md:grid-cols-3 -> md:grid-cols-2 ‡πÅ‡∏•‡∏∞ "‡∏•‡∏ö" linesSelect ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏Å‡∏•‡∏á -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label for="addressSelect" class="block text-sm font-medium mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
              <select id="addressSelect" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"></select>
            </div>
            <div>
              <label for="obfuscationSelect" class="block text-sm font-medium mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏û‡∏£‡∏≤‡∏á‡∏ï‡∏±‡∏ß</label>
              <select id="obfuscationSelect" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2"></select>
            </div>
            <!-- (‡∏•‡∏ö dropdown ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏≠‡∏≠‡∏Å) -->
          </div>
        </div>

        <div class="panel rounded-xl p-6">
          <h3 class="text-xl font-bold mb-4 text-center">üìö ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á (5 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h3>
          <div id="historyContainer" class="space-y-2 max-h-60 overflow-y-auto">
            <div class="text-center text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>
          </div>
        </div>
        <div id="statusMessage" class="text-center mt-4 text-sm text-gray-500"></div>
      </section>

      <!-- Tab 2: Message Board (‡πÄ‡∏î‡∏¥‡∏°) -->
      <section id="board-tab">
        <header class="text-center mb-8 py-8 rounded-2xl panel">
          <h1 class="text-3xl sm:text-4xl font-bold" style="background-image: linear-gradient(90deg, var(--primary), var(--accent)); -webkit-background-clip:text; background-clip:text; color: transparent;">‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞</h1>
          <p class="text-gray-200 mt-2">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p>
          <div class="mt-4 text-sm" style="color:#93c5fd"><span>ID ‡∏ö‡∏≠‡∏£‡πå‡∏î: </span><span id="board-id-display" class="font-mono bg-gray-800 p-1 rounded shadow-inner"></span></div>
        </header>

        <div class="p-6 rounded-2xl shadow-2xl mb-8 gradient-border">
          <form id="message-form">
            <label for="title-input" class="block text-lg font-semibold mb-2" style="color:#93c5fd">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠/‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå:</label>
            <input id="title-input" type="text" class="w-full p-3 mb-3 bg-[#16223a] text-cyan-200 border border-cyan-700 focus:border-cyan-400 focus:ring-0 rounded-lg transition placeholder:text-cyan-700" placeholder="‡πÉ‡∏™‡πà‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå..." />
            <label for="message-input" class="block text-lg font-semibold mb-2" style="color:#93c5fd">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</label>
            <textarea id="message-input" rows="4" class="w-full p-3 bg-[#16223a] text-cyan-100 border border-cyan-700 focus:border-cyan-400 focus:ring-0 rounded-lg transition placeholder:text-cyan-700" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
            <button type="submit" id="post-button" class="mt-4 w-full btn btn-primary">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
          </form>
        </div>

        <div id="messages-container" class="space-y-4">
          <div id="loading-state" class="text-center py-10"><p class="text-gray-400">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...</p></div>
        </div>
      </section>
    </main>
  </div>

  <!-- ====== SCRIPTS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏Ñ‡∏á logic/ID/‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô 100%) ====== -->
  <script>
    // Tab Switching Logic ‚Äî ‡πÄ‡∏î‡∏¥‡∏°
    document.addEventListener('DOMContentLoaded', () => {
      const tabs = document.querySelectorAll('main > section');
      const buttons = document.querySelectorAll('nav button');
      function switchTab(tabId) {
        tabs.forEach(tab => tab.classList.add('hidden'));
        const activeTab = document.getElementById(tabId);
        if (activeTab) activeTab.classList.remove('hidden');
        buttons.forEach(button => button.classList.remove('active-tab'));
        const activeButton = document.getElementById(`btn-${tabId}`);
        if (activeButton) activeButton.classList.add('active-tab');
      }
      buttons.forEach(button => button.addEventListener('click', () => switchTab(button.id.replace('btn-',''))));
      switchTab('address-tab');
    });
  </script>

  <!-- Address Generator Script ‚Äî ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (1) ‡∏ï‡∏±‡∏î linesSelect (2) ‡πÄ‡∏û‡∏¥‡πà‡∏° separator ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ 2‚Äì3 ‡∏ä‡πà‡∏≠‡∏á (3) ‡∏Ç‡∏¢‡∏≤‡∏¢ house/phone labels -->
  <script>
  (() => {
    const ADDRESSES = {
      home: { houseNumber: "82/7", soi: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á16", village: "‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£2", road: "‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á", subdistrict: "‡∏£‡∏≤‡∏ä‡∏≤‡πÄ‡∏ó‡∏ß‡∏∞", district: "‡∏ö‡∏≤‡∏á‡∏û‡∏•‡∏µ", province: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", postalCode: "10540" },
      alt1: { houseNumber: "22/4", soi: "‡πÉ‡∏à‡πÄ‡∏≠‡∏∑‡πâ‡∏≠ 2", village: "", road: "", subdistrict: "‡∏ö‡∏≤‡∏á‡∏Ç‡∏∞‡πÅ‡∏¢‡∏á", district: "", province: "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", postalCode: "12000" }
    };
    const PHONES = { home: "0951698770", alt1: "0946401569" };
    let CURRENT_ADDRESS_KEY = 'home';

    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞ addressSelect / obfuscationSelect (‡∏•‡∏ö linesSelect ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏Å‡∏•‡∏á)
    document.getElementById('addressSelect').innerHTML = '<option value="home">‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏ó‡∏¢‡∏™‡∏°‡∏∏‡∏ó‡∏£</option><option value="alt1">‡∏ö‡πâ‡∏≤‡∏ô‡∏õ‡∏ó‡∏∏‡∏°</option>';
    document.getElementById('obfuscationSelect').innerHTML = '<option value="low">üü¢ ‡∏ï‡πà‡∏≥ - ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</option><option value="medium" selected>üü° ‡∏Å‡∏•‡∏≤‡∏á - ‡∏™‡∏°‡∏î‡∏∏‡∏•</option><option value="high">üî¥ ‡∏™‡∏π‡∏á - ‡∏û‡∏£‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏Å</option><option value="extreme">‚ö´ ‡∏™‡∏∏‡∏î‡∏Ç‡∏±‡πâ‡∏ô - ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å</option>';

    document.getElementById('addressSelect').addEventListener('change', (e) => { CURRENT_ADDRESS_KEY = e.target.value; generateNew(); });

    let stats = { generateCount: 0, copyCount: 0 };
    let history = [];

    // ===== Labels ‡∏õ‡∏Å‡∏ï‡∏¥ + Fuzzy (‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞ house/phone) =====
    const Labels = {
      house: [
        '‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô',
        'House No.', 'Address No.', 'Addr. No.', 'Unit',
        '#', ''
      ],
      phone: [
        '‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå', '‡πÇ‡∏ó‡∏£', '‡πÄ‡∏ö‡∏≠‡∏£‡πå', '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£',
        'Tel', 'Tel.', 'Mobile', 'Contact', 'Contact No.',
        ''
      ],
      soi: ['‡∏ã‡∏≠‡∏¢', '‡∏ã.', 'Soi', ''],
      village: ['‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô', '‡∏°.', '‡∏´‡∏°‡∏π‡πà', ''],
      road: ['‡∏ñ‡∏ô‡∏ô', '‡∏ñ.', 'Rd.', ''],
      subdistrict: ['‡∏ï‡∏≥‡∏ö‡∏•', '‡∏ï.', ''],
      district: ['‡∏≠‡∏≥‡πÄ‡∏†‡∏≠', '‡∏≠.', ''],
      province: ['‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î', '‡∏à.', ''],
      postal: ['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±‡∏™', 'Zip', '']
    };

    const FuzzyLabels = {
      house: [
        '‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡πÖ‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏ã‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤‡∏ô‡πÄx‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡∏≤u‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà',
        '‡∏ö‡πÖ‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', '‡∏ö‡πâ‡πÖ‡∏ô‡πÄ‡∏•x‡∏ó‡∏µ‡πà', '‡∏ö‡∏≤u‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà', 'l‡∏ö‡πÖ‡∏ô‡πÄ‡∏•‡∏Ç',
        'H0use No.', 'H‡πêuse', 'Addr. No.', 'L‡∏ö‡πâ‡∏≤‡∏ô'
      ],
      phone: [
        '‡πÇ‡∏ós‡∏±‡∏û‡∏ó‡πå', '‡πÇ‡∏ó‡∏£s‡∏±s‡∏ó‡πå', '‡πÇ‡∏óp‡∏®‡∏±‡∏û', '‡πÇ‡∏ó‡∏£s‡∏±‡∏ö',
        '‡πÄbo‡∏£‡πå', 'l‡πÄ‡∏öo‡∏£‡πå', '‡πÄb‡∏≠‡∏£‡πå', '‡πÇ‡∏ós', 'T‚ÑÆl', 'Mob1le',
        'C0ntact', 'Tel.'
      ],
      soi: ['‡∏ão‡∏¢', '‡∏ãx‡∏¢', '‡∏ã0‡∏¢'],
      village: ['‡∏´‡∏°‡∏π‡πà‡∏ö‡∏≤u', '‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤u', '‡∏´‡∏°‡∏πv‡∏ö‡∏≤u'],
      road: ['‡∏ñu‡∏ô', '‡∏ñuv', '‡∏ñv‡∏ô'],
      subdistrict: ['‡∏ï‡∏≥‡∏öu', '‡∏ï‡πç‡∏≤‡∏ö‡∏•', '‡∏ïx‡∏ö‡∏•'],
      district: ['‡∏≠‡∏≥p‡∏≠', '‡∏≠‡∏≥‡πÄ‡πÖ‡∏≠', '‡∏≠‡πç‡∏≤‡πÄ‡∏†o'],
      province: ['‡∏à‡∏±‡∏á‡∏´‡∏ß‡πâ‡∏î', '‡∏à‡∏±n‡∏´‡∏ß‡∏±‡∏î', '‡∏à‡∏±J‡∏´‡∏ß‡∏±‡∏î'],
      postal: ['‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õs‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±n‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå', '‡∏£‡∏´‡∏±‡∏™‡πÑp‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå']
    };

    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏Ñ‡∏±‡πà‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á 1‚Äì3 ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°
    const Separators = [', ', ' ', '  ', '   ', '. ', ' - '];

    const ObfuscationUtils = {
      Punctuation: ['.', ',', '/', '-', '_'],
      toThaiNumerals: (str) => str.replace(/[0-9]/g, (d) => '‡πê‡πë‡πí‡πì‡πî‡πï‡πñ‡πó‡πò‡πô'[d]),
      addZeroWidthSpaces: (str) => str.split('').join('\u200B'),
      injectPunctuation: (str) => {
        const level = document.getElementById('obfuscationSelect').value;
        const chance = { low: 0, medium: 0.05, high: 0.15, extreme: 0.3 }[level];
        if (chance === 0 || !str) return str;
        let result = '';
        for (const char of str) {
          result += char;
          if (Math.random() < chance && char !== ' ' && !ObfuscationUtils.Punctuation.includes(char)) {
            result += ObfuscationUtils.Punctuation[Math.floor(Math.random() * ObfuscationUtils.Punctuation.length)];
          }
        }
        return result;
      },
      formatNumber: (num) => {
        if (!num) return '';
        const formats = [num, num.replace('/', ' / '), num.replace('/', '-'), `No.${num}`, num.split('').join(' ')];
        return formats[Math.floor(Math.random() * formats.length)];
      },
      formatPhone: (phone) => {
        if (!phone) return '';
        const formats = [phone, phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3'), phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1 $2 $3'), '+66 ' + phone.slice(1)];
        return formats[Math.floor(Math.random() * formats.length)];
      },
      generateVariationCode: () => 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'[Math.floor(Math.random() * 26)] + '0123456789'[Math.floor(Math.random() * 10)]
    };

    function generateRandomAddress() {
      const startTime = Date.now();
      const level = document.getElementById('obfuscationSelect').value;
      const selectedAddress = ADDRESSES[CURRENT_ADDRESS_KEY];
      const selectedPhone = PHONES[CURRENT_ADDRESS_KEY];
      const postal = Math.random() < 0.5 ? ObfuscationUtils.toThaiNumerals(selectedAddress.postalCode) : selectedAddress.postalCode;
      const allComponents = [
        { type:'house', value:`<mark class="house-highlight">${ObfuscationUtils.formatNumber(selectedAddress.houseNumber)}</mark>`, labelPool: Labels.house, required: !!selectedAddress.houseNumber },
        { type:'phone', value: ObfuscationUtils.formatPhone(selectedPhone), labelPool: Labels.phone, required: !!selectedPhone },
        { type:'soi', value: selectedAddress.soi, labelPool: Labels.soi },
        { type:'village', value: selectedAddress.village, labelPool: Labels.village },
        { type:'road', value: selectedAddress.road, labelPool: Labels.road },
        { type:'subdistrict', value: selectedAddress.subdistrict, labelPool: Labels.subdistrict },
        { type:'district', value: selectedAddress.district, labelPool: Labels.district },
        { type:'province', value: selectedAddress.province, labelPool: Labels.province },
        { type:'postal', value: postal, labelPool: Labels.postal }
      ].filter(c => c.value && String(c.value).replace(/<[^>]*>/g, '').trim() !== '');

      const required = allComponents.filter(c => c.required);
      const optional = allComponents.filter(c => !c.required);
      const numOptionalToUse = Math.floor(Math.random() * (optional.length - 2)) + 3;
      const componentsToUse = [...required, ...optional.sort(() => 0.5 - Math.random()).slice(0, numOptionalToUse)].sort(() => 0.5 - Math.random());

      const formattedParts = componentsToUse.map(comp => {
        let label = comp.labelPool[Math.floor(Math.random() * comp.labelPool.length)];
        if (Math.random() < 0.4 && FuzzyLabels[comp.type]?.length > 0) {
          label = FuzzyLabels[comp.type][Math.floor(Math.random() * FuzzyLabels[comp.type].length)];
        }
        const showLabel = label && (comp.required || Math.random() > 0.3);
        const value = comp.type === 'house' ? comp.value : ObfuscationUtils.injectPunctuation(comp.value);
        let part = showLabel ? `${label} ${value}` : value;
        if (comp.type !== 'house'){
          if (level === 'extreme' && Math.random() < 0.5) return ObfuscationUtils.addZeroWidthSpaces(part);
          if (level === 'high' && Math.random() < 0.3) return ObfuscationUtils.addZeroWidthSpaces(part);
        }
        return part.trim();
      });

      // === ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö 1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÄ‡∏™‡∏°‡∏≠ + ‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏Ñ‡∏±‡πà‡∏ô‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á 1‚Äì3 ‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ ===
      let lineStr = '';
      for (let i = 0; i < formattedParts.length; i++) {
        if (i > 0) {
          const sep = Separators[Math.floor(Math.random() * Separators.length)];
          lineStr += sep; // ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô ' ', '  ', '   ', ', ', '. ', ' - '
        }
        lineStr += formattedParts[i];
      }
      const result = lineStr;

      const endTime = Date.now();
      const generationTime = endTime - startTime;
      const variationCode = ObfuscationUtils.generateVariationCode();

      document.getElementById('resultDisplay').innerHTML = result;
      document.getElementById('generationTime').textContent = `${generationTime}ms`;
      document.getElementById('currentVariation').textContent = variationCode;

      stats.generateCount++;
      document.getElementById('generateCount').textContent = stats.generateCount;

      const obfuscationIcons = { low: 'üü¢', medium: 'üü°', high: 'üî¥', extreme: '‚ö´' };
      document.getElementById('obfuscationLevel').textContent = obfuscationIcons[level];

      history.unshift({ result: result.replace(/<[^>]*>/g, ''), time: new Date().toLocaleTimeString('th-TH'), variation: variationCode });
      if (history.length > 5) history.pop();
      updateHistoryDisplay();
    }

    function updateHistoryDisplay() {
      const container = document.getElementById('historyContainer');
      if (history.length === 0) {
        container.innerHTML = '<div class="text-center text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div>';
        return;
      }
      container.innerHTML = history.map((item, index) => `
        <div class="bg-gray-800 p-3 rounded-lg text-sm">
          <div class="flex justify-between items-center mb-2">
            <span class="text-purple-400 font-mono">${item.variation}</span>
            <span class="text-gray-400">${item.time}</span>
          </div>
          <div class="text-gray-300 text-xs whitespace-pre-wrap">${item.result}</div>
        </div>
      `).join('');
    }

    function copyToClipboard() {
      const resultText = document.getElementById('resultDisplay').textContent;
      if (!resultText.trim()) {
        alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô');
        return;
      }
      navigator.clipboard.writeText(resultText).then(() => {
        stats.copyCount++;
        document.getElementById('copyCount').textContent = stats.copyCount;
        showToast();
      }).catch(err => {
        console.error('Failed to copy: ', err);
        alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ');
      });
    }

    function clearResult() {
      document.getElementById('resultDisplay').innerHTML = '';
      document.getElementById('generationTime').textContent = '';
      document.getElementById('currentVariation').textContent = 'A1';
      document.getElementById('obfuscationLevel').textContent = 'üîí';
    }

    function generateNew() { generateRandomAddress(); }
    function showToast() { const toast = document.getElementById('toast'); toast.classList.remove('opacity-0', 'translate-y-10'); toast.classList.add('opacity-100', 'translate-y-0'); setTimeout(() => { toast.classList.remove('opacity-100', 'translate-y-0'); toast.classList.add('opacity-0', 'translate-y-10'); }, 2000); }

    document.getElementById('generateBtn').addEventListener('click', generateNew);
    document.getElementById('copyBtn').addEventListener('click', copyToClipboard);
    document.getElementById('clearBtn').addEventListener('click', clearResult);

    generateNew();
  })();
  </script>

  <!-- Matrix Background Animation -->
  <script>
    (() => {
      const canvas = document.getElementById('matrixCanvas');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const matrix = "ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%+-/~{[|`]}";
      const matrixArray = matrix.split("");
      const fontSize = 10;
      const columns = canvas.width / fontSize;
      const drops = [];
      for (let x = 0; x < columns; x++) { drops[x] = 1; }
      function draw() {
        ctx.fillStyle = 'rgba(0, 0, 0, 0.04)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#0F3';
        ctx.font = fontSize + 'px monospace';
        for (let i = 0; i < drops.length; i++) {
          const text = matrixArray[Math.floor(Math.random() * matrixArray.length)];
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);
          if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) { drops[i] = 0; }
          drops[i]++;
        }
      }
      setInterval(draw, 35);
      window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
    })();
  </script>

  <!-- Message Board Script ‚Äî Supabase (‡∏™‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å Firestore ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏á UI/ID/‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°) -->
  <script type="module">
    // ===== Config ‡∏à‡∏≤‡∏Å‡πÄ‡∏ô‡∏° =====
    const SUPABASE_URL = "https://uromhoezcxkhilxchxxe.supabase.co"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVyb21ob2V6Y3hraGlseGNoeHhlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMjEyOTUsImV4cCI6MjA2ODY5NzI5NX0.UDABYee8_JDlZHkKGzz6bQG0v95H86uLAP6WIN75Y7o";

    // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠/‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á/ID/‡∏•‡∏≠‡∏à‡∏¥‡∏Å‡πÄ‡∏î‡∏¥‡∏°
    const SHARED_BOARD_ID = 'my-shared-board-123';
    const appId = SHARED_BOARD_ID;

    let currentUserId = 'anon';
    let messagesChannel = null;

    const messageForm = document.getElementById('message-form');
    const messageInput = document.getElementById('message-input');
    const titleInput = document.getElementById('title-input');
    const messagesContainer = document.getElementById('messages-container');
    const loadingState = document.getElementById('loading-state');
    const toast = document.getElementById('toast');
    const boardIdDisplay = document.getElementById('board-id-display');

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á client
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    async function main(){
      boardIdDisplay.textContent = appId;
      try{
        listenForMessages();
      }catch(error){ console.error("Error initializing Supabase:", error); loadingState.textContent = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå"; }
    }

    function listenForMessages(){
      if (messagesChannel) { sb.removeChannel(messagesChannel); }
      // ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≠‡∏ö‡πÅ‡∏£‡∏Å
      loadAndRender();
      // realtime ‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á links
      messagesChannel = sb.channel('links-realtime')
        .on('postgres_changes', { event: '*', schema: 'public', table: 'links' }, () => { loadAndRender(); })
        .subscribe();
    }

    async function loadAndRender(){
      loadingState.style.display = 'none';
      const { data, error } = await sb
        .from('links')
        .select('id, title, url, created_at, is_pinned')
        .order('created_at', { ascending: false });
      if (error){ console.error("Error loading:", error); messagesContainer.innerHTML = `<p class="text-center text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏î‡πâ</p>`; return; }

      // map ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏Ñ‡∏£‡∏á Firestore ‡πÄ‡∏î‡∏¥‡∏°
      const messages = (data || []).map(row => ({
        id: row.id,
        title: row.title || '',
        text: row.url || '',
        isPinned: !!row.is_pinned,
        timestamp: { toDate: () => new Date(row.created_at) }
      }));

      // ‡∏û‡∏¥‡∏ô‡πÑ‡∏ß‡πâ‡∏ö‡∏ô‡∏™‡∏∏‡∏î (‡πÄ‡∏î‡∏¥‡∏°)
      messages.sort((a, b) => {
        if (a.isPinned && !b.isPinned) return -1;
        if (!a.isPinned && b.isPinned) return 1;
        return 0;
      });

      renderMessages(messages);
    }

    async function postMessage(text, title){
      if (!text.trim()) return;
      try{
        const { error } = await sb.from('links').insert([{ title: title||'', url: text, is_pinned: false }]);
        if (error) throw error;
        messageInput.value=''; titleInput.value='';
      }catch(error){ console.error("Error posting message:", error); alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°"); }
    }

    function renderMessages(messages){
      messagesContainer.innerHTML=''; if (messages.length===0){ messagesContainer.innerHTML = `<p class="text-center text-gray-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏•‡∏≠‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å‡∏™‡∏¥!</p>`; return; }
      messages.forEach(msg => { const messageElement = createMessageElement(msg); messagesContainer.appendChild(messageElement); });
    }

    function createMessageElement(msg){
      const div = document.createElement('div');
      div.className = `p-5 rounded-xl flex flex-col gap-4 fade-in gradient-border transition-transform duration-300 hover:scale-[1.02] ${msg.isPinned ? 'pinned-message' : ''}`;

      let content = '';
      if (msg.title && msg.title.trim()){ content += `<div class="font-bold text-lg tracking-wide" style="color:#93c5fd">${escapeHTML(msg.title)}</div>`; }
      content += `<p class="text-cyan-100 whitespace-pre-wrap flex-1 text-base">${escapeHTML(msg.text)}</p>`;
      content += `<div class="flex items-center justify-between gap-4 w-full pt-2 border-t border-cyan-800/50">
        <span class="text-xs" style="color:#93c5fd">${msg.timestamp ? new Date(msg.timestamp.toDate()).toLocaleString('th-TH') : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...'}</span>
        <div class="flex items-center gap-2">
          ${msg.isPinned ? '<span class="text-yellow-400 text-lg">üìå</span>' : ''}
          <button class="pin-button btn btn-primary py-1 px-4 rounded-full text-sm">${msg.isPinned ? '‡πÄ‡∏•‡∏¥‡∏Å‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î' : '‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î'}</button>
          <button class="copy-button btn btn-primary py-1 px-4 rounded-full text-sm">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å</button>
        </div>
      </div>`;
      div.innerHTML = content;
      div.querySelector('.copy-button').onclick = (e) => { copyTextToClipboard(msg.text, e.target); };
      div.querySelector('.pin-button').onclick = () => { togglePinMessage(msg.id); };
      return div;
    }

    function escapeHTML(str){ const p = document.createElement('p'); p.textContent = str; return p.innerHTML; }
    messageForm.addEventListener('submit', (e) => { e.preventDefault(); postMessage(messageInput.value, titleInput.value); });

    async function togglePinMessage(messageId) {
      const { data, error } = await sb.from('links').select('is_pinned').eq('id', messageId).single();
      if (error){ console.error('togglePin read error:', error); return; }
      const currentPinnedStatus = !!data.is_pinned;
      const { error: upErr } = await sb.from('links').update({ is_pinned: !currentPinnedStatus }).eq('id', messageId);
      if (upErr){ console.error('togglePin update error:', upErr); }
    }

    function showToast(){ toast.classList.remove('opacity-0','translate-y-10'); toast.classList.add('opacity-100','translate-y-0'); setTimeout(() => { toast.classList.remove('opacity-100','translate-y-0'); toast.classList.add('opacity-0','translate-y-10'); }, 2000); }
    function copyTextToClipboard(text, button){ navigator.clipboard.writeText(text).then(() => { showToast(); if (button){ button.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!'; setTimeout(() => { button.textContent = '‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å'; }, 2000); } }).catch(err => { console.error('Failed to copy text: ', err); }); }

    main();
  </script>
</body>
</html>
